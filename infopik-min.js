/*! Infopik v0.0.0 | (c) Hatio, Lab. | MIT License */
!function(t){function e(){var t,e,n=Array.prototype.slice.call(arguments),o=[];"string"==typeof n[0]&&(t=n.shift()),r(n[0])&&(o=n.shift()),e=n.shift(),i[t]=[o,e]}function n(t){function e(e){var n=t.split("/"),i=e.split("/"),o=!1;for(n.pop();".."==i[0]&&n.length;)n.pop(),i.shift(),o=!0;return"."==i[0]&&(i.shift(),o=!0),o&&(i=n.concat(i)),i.join("/")}var r,c,a;return"undefined"==typeof o[t]&&(r=i[t],r&&(a=r[0],c=r[1],o[t]=c.apply(void 0,s(a,function(t){return n(e(t))})))),o[t]}var i={dou:[[],function(){return t.dou}],bwip:[[],function(){return t.bwip}],KineticJS:[[],function(){return t.Kinetic}]},o={},r=Array.isArray||function(t){return t.constructor==Array},s=Array.map||function(t,e,n){for(var i=0,o=t.length,r=[];o>i;i++)r.push(e.call(n,t[i]));return r};!function(){e("build/MVCMixin",["dou"],function(){"use strict";var t,e,n,i,o,r,s,c,a;return t=function(t,e,n){return e?(t.__views__||(t.__views__=[]),t.__views__.push(e),n?r(e,t,!1):void 0):void 0},n=function(t,e,n){var i;if(e&&t.__views__&&(i=t.__views__.indexOf(e),-1!==i))return t.__views__.splice(i,1),n?r(e,null,!1):void 0},e=function(t){var e,n,i,o;if(t.__views__){for(o=t.__views__,n=0,i=o.length;i>n;n++)e=o[n],r(e,null,!1);return t.__views__=null}},o=function(t){var e,n,i,o,r,s;if(e=[],!t.__views__)return e;for(r=t.__views__,s=[],i=0,o=r.length;o>i;i++)n=r[i],s.push(n);return s},r=function(e,i,o){var r;return r=e.__model__,r!==i?(r&&o&&n(r,e,!1),e.__model__=i,i&&o?t(i,e,!1):void 0):void 0},i=function(t){return t.__model__},c=function(){return this.attachView=function(e){return t(this,e,!0)},this.detachView=function(t){return n(this,t,!0)},this.detachAll=function(){return e(this)},this.getViews=function(){return o(this)}},a=function(){return this.getModel=function(){return i(this)},this.setModel=function(t){return r(this,t,!0)}},s=function(){return this.attach=function(e,n){return t(e,n,!0)},this.detach=function(t,e){return n(t,e,!0)},this.detachAll=function(t){return e(t)},this.getAttachedModel=function(t){return i(t)},this.getAttachedViews=function(t){return o(t)}},{controller:s,model:c,view:a}})}.call(this),function(){e("build/Component",["dou","./MVCMixin"],function(t,e){"use strict";var n;return n=function(){function t(t,e){this.type=t,this.container=e}return t.prototype.getContainer=function(){return this.container},t.prototype.setContainer=function(t){return this.container=t},t.prototype.moveAt=function(t){return this.getContainer()?this.container.moveChildAt(t,this):void 0},t.prototype.moveUp=function(){return this.getContainer()?this.container.moveChildUp(this):void 0},t.prototype.moveDown=function(){return this.getContainer()?this.container.moveChildDown(this):void 0},t.prototype.moveToTop=function(){return this.getContainer()?this.container.moveChildToTop(this):void 0},t.prototype.moveToBottom=function(){return this.getContainer()?this.container.moveChildToBottom(this):void 0},t}(),t.mixin(n,[t["with"].advice,t["with"].event,t["with"].property,t["with"].lifecycle,t["with"].serialize,e.model])})}.call(this),function(){var t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e("build/Container",["dou","./Component"],function(t,e){"use strict";var i,o,r,s,c,a,h,u,l,p,f,d,g,_,m;return o=[],s=function(t,n){var i;return i=t.__components__.push(n)-1,t.trigger("add",t,n,i),n instanceof e?(n.delegate_on(t),n.trigger("added",t,n,i)):void 0},_=function(t,n){var i;return i=t.__components__.indexOf(n),-1!==i&&(i>-1&&t.__components__.splice(i,1),t.trigger("remove",t,n),n instanceof e)?(n.trigger("removed",t,n),n.delegate_off(t)):void 0},r=function(t){var e,n,i;if(this.__components__||(this.__components__=[]),!(t instanceof Array))return r.call(this,[t]);if(-1===this.__components__.indexOf(e))for(n=0,i=t.length;i>n;n++)e=t[n],s(this,e);return this},g=function(t){var e,n,i;if(!(t instanceof Array))return g.call(this,[t]);if(this.__components__){for(n=0,i=t.length;i>n;n++)e=t[n],_(this,e);return this}},a=function(t){return this.__components__?this.__components__[t]:void 0},c=function(t,e){return this.__components__?this.__components__.forEach(t,e):void 0},h=function(t){return(this.__components__||o).indexOf(t)},m=function(){return(this.__components__||o).length},u=function(t,e){var n,i,o;return i=this.indexOf(e),-1!==i?(n=this.__components__.splice(0,i),o=this.__components__.splice(1),this.__components__=n.concat(o),t=Math.max(0,t),t=Math.min(t,this.__components__.length),n=this.__components__.splice(0,t),this.__components__=n.concat(e,this.__components__)):void 0},d=function(t){var e;return e=this.indexOf(t),-1!==e&&e!==this.size()-1?(this.__components__[e]=this.__components__[e+1],this.__components__[e+1]=t):void 0},l=function(t){var e;return e=this.indexOf(t),-1!==e&&0!==e?(this.__components__[e]=this.__components__[e-1],this.__components__[e-1]=t):void 0},f=function(t){var e,n,i;return n=this.indexOf(t),-1!==n&&n!==this.size()-1?(e=this.__components__.splice(0,n),i=this.__components__.splice(1),this.__components__=e.concat(i,this.__components__)):void 0},p=function(t){var e,n,i;return n=this.indexOf(t),-1!==n&&0!==n?(e=this.__components__.splice(0,n),i=this.__components__.splice(1),this.__components__=this.__components__.concat(e,i)):void 0},i=function(t){function e(t){e.__super__.constructor.call(this,t)}return n(e,t),e.prototype.add=r,e.prototype.remove=g,e.prototype.size=m,e.prototype.getAt=a,e.prototype.indexOf=h,e.prototype.forEach=c,e.prototype.moveChildAt=u,e.prototype.moveChildUp=d,e.prototype.moveChildDown=l,e.prototype.moveChildToTop=f,e.prototype.moveChildToBottom=p,e}(e)})}.call(this),function(){e("build/ComponentSelector",["dou","./Component","./Container"],function(t,e,n){"use strict";var i,o,r,s,c,a,h;return o=function(t,e){return t.substr(1)===e.get("id")},r=function(t,e){return t.substr(1)===e.get("name")},s=function(t,e,n,i){switch(t){case"(all)":return!0;case"(self)":return n===e;case"(root)":return i===e;default:return!1}},c=function(t,e){return"all"===t||t===e.type},i=function(t,e,n,i){if("(all)"===t)return!0;switch(t.charAt(0)){case"#":return o(t,e,n,i);case".":return r(t,e,n,i);case"(":return s(t,e,n,i);default:return c(t,e,n,i)}},h=function(t,e,i,o,r,s){return t(e,i,o,r)&&s.push(i),i instanceof n&&i.forEach(function(n){return h(t,e,n,o,r,s)}),s},a=function(t,e,n){var i;return"(root)"===t?[e]:"(self)"===t?[n]:(i=function(){switch(t.charAt(0)){case"#":return o;case".":return r;case"(":return s;default:return c}}(),h(i,t,e,n,e,[]))},{select:a,match:i}})}.call(this),function(){var t={}.hasOwnProperty;e("build/EventPump",["dou","./ComponentSelector"],function(e,n){"use strict";var i,o,r;return o=function(e,i,o,r,s){var c,a,h,u,l;l=[];for(u in o)t.call(o,u)&&(c=o[u],n.match(u,r.origin,i,e)&&l.push(function(){var e;e=[];for(a in c)t.call(c,a)&&(h=c[a],a===r.name&&(r.listener=i,e.push(h.apply(this,s))));return e}.call(this)));return l},r=function(){var t,e,n,i,r,s,c,a;for(t=arguments,e=t[t.length-1],n=this.eventPump,c=n.listeners,a=[],r=0,s=c.length;s>r;r++)i=c[r],a.push(o.call(this.context,n.deliverer,i.listener,i.clonedHandlers,e,t));return a},i=function(){function t(t){this.setDeliverer(t),this.listeners=[]}return t.prototype.setDeliverer=function(t){return this.deliverer=t},t.prototype.start=function(t){return this.deliverer.on("all",r,{context:t||null,eventPump:this})},t.prototype.stop=function(){return this.deliverer.off("all",r)},t.prototype.on=function(t,n){var i,o,r,s,c,a,h,u;for(i=e.util.clone(n),s=Object.keys(i),h=0,u=s.length;u>h;h++)r=s[h],0===r.indexOf("?")&&(o=i[r],a=r.substr(1),c=t.get(a),delete i[r],c?i[c]=o:console.log("EventPump#on","variable "+r+" is not evaluated on listener"));return this.listeners.push({listener:t,handlers:n,clonedHandlers:i})},t.prototype.off=function(t,e){var n,i,o,r,s,c;for(s=this.listeners,c=[],n=o=0,r=s.length;r>o;n=++o)i=s[n],i.listener!==t||e&&i.handlers!==e?c.push(void 0):c.push(this.listeners.splice(n,1));return c},t.prototype.clear=t.listeners=[],t.prototype.despose=function(){return this.stop(),this.clear(),this.deliverer=null},t}()})}.call(this),function(){var t={}.hasOwnProperty;e("build/EventEngine",["dou","./EventPump","./ComponentSelector"],function(e,n,i){"use strict";var o;return o=function(){function e(t){this.eventPumps=[],this.setRoot(t)}return e.prototype.setRoot=function(t){return this.root=t},e.prototype.stop=function(){var t,e,n,i,o;for(i=this.eventPumps,o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(t.eventPump.stop());return o},e.prototype.add=function(e,o,r){var s,c,a,h,u,l;if(this.root){l=[];for(a in o)t.call(o,a)&&(c=o[a],u=i.select(a,this.root,e),l.push(function(){var t,i,a;for(a=[],t=0,i=u.length;i>t;t++)h=u[t],s=new n(h),s.on(e,c),s.start(r),a.push(this.eventPumps.push({eventPump:s,listener:e,handlerMap:o,target:h}));return a}.call(this)));return l}},e.prototype.remove=function(t,e){var n,i,o,r,s,c;for(s=this.eventPumps,c=[],n=o=0,r=s.length;r>o;n=++o)i=s[n],i.listener!==t||e&&i.handlerMap!==e?c.push(void 0):(this.eventPumps.splice(n,1),c.push(i.eventPump.despose()));return c},e.prototype.clear=function(){var t,e,n,i;for(i=this.eventPumps,e=0,n=i.length;n>e;e++)t=i[e],t.despose();return this.eventPumps=[]},e.prototype.despose=function(){return this.stop(),this.clear()},e}()})}.call(this),function(){var t={}.hasOwnProperty;e("build/EventTracker",["dou"],function(){"use strict";var e,n;return n=function(){function e(e,n,i){var o,r;this.started=!1,e&&(this.target=e),this.handlers=n,i=i||this.target||this,this.boundhandler={};for(o in n)t.call(n,o)&&(r=n[o],"function"==typeof r&&(this.boundhandler[o]=r.bind(i)))}return e.prototype.on=function(){var e,n,i;if(!this.started){i=this.boundhandler;for(e in i)t.call(i,e)&&(n=i[e],this.target.on(e,n));return this.started=!0}},e.prototype.off=function(){var e,n,i;i=this.boundhandler;for(e in i)t.call(i,e)&&(n=i[e],this.target.off(e,n));return this.started=!1},e}(),e=function(){function t(){this.trackers=[]}return t.prototype.setSelector=function(t){return this.selector=t},t.prototype.on=function(t,e,i,o){var r,s,c,a,h,u;for(s=function(){switch(typeof t){case"object":return[t];case"string":return this.selector.select(t,i);default:return[]}}.call(this),s instanceof Array||(s=[s]),u=[],a=0,h=s.length;h>a;a++)r=s[a],c=new n(r,e,{listener:i,deliverer:r,context:o||r}),this.trackers.push(c),u.push(c.on());return u},t.prototype.off=function(t,e){var n,i,o,r,s,c,a,h;for(o=function(){var i,o,s,c;for(s=this.trackers,c=[],n=i=0,o=s.length;o>i;n=++i)r=s[n],t!==r.target||e&&e!==r.handlers||c.push(n);return c}.call(this),a=o.reverse(),h=[],s=0,c=a.length;c>s;s++)i=a[s],h.push(this.trackers.splice(i,1)[0].off());return h},t.prototype.all=function(){var t,e,n,i,o;for(i=this.trackers,o=[],e=0,n=i.length;n>e;e++)t=i[e],o.push(t);return o},t.prototype.despose=function(){var t,e,n,i;for(i=this.trackers,e=0,n=i.length;n>e;e++)t=i[e],t.off();return this.trackers=[],this.selector=null},t.StandAlone=n,t}()})}.call(this),function(){var t={}.hasOwnProperty;e("build/ComponentFactory",["dou","./MVCMixin","./Component","./Container","./EventEngine","./EventTracker"],function(e,n,i,o){"use strict";var r;return r=function(){function n(t,e,n){this.componentRegistry=t,this.eventEngine=e,this.eventTracker=n}return n.prototype.seed=1,n.prototype.despose=function(){return this.componentRegistry=null,this.eventEngine?this.eventEngine.despose():void 0},n.prototype.uniqueId=function(){return"noid-"+this.seed++},n.prototype.createView=function(e,n){var i,r,s,c,a,h,u;if(c=e.type,s=this.componentRegistry.get(c),!s)throw new Error("Component Spec Not Found for type '"+c+"'");if(h=s.view_factory_fn.call(n,e.getAll()),n.attach(e,h),e instanceof o&&e.forEach(function(t){return h.add(this.createView(t,n))},this),s.view_listener){u=s.view_listener;for(r in u)t.call(u,r)&&(i=u[r],0!==r.indexOf("?")||(a=r.substr(1),r=e.get(a),void 0!==r)?this.eventTracker.on(r,i,h,n):console.log("ComponentFactory#crateView","variable "+r+" is not evaluated on listener"))}return h},n.prototype.createComponent=function(t,n){var r,s,c,a,h,u,l,p,f;if(c=this.componentRegistry.get(t.type),!c)throw new Error("Component Spec Not Found for type '"+t.type+"'");if(c.containable){if(s=new o(t.type),c.components)for(p=c.components,a=0,u=p.length;u>a;a++)r=p[a],s.add(this.createComponent(r,n));if(t.components)for(f=t.components,h=0,l=f.length;l>h;h++)r=f[h],s.add(this.createComponent(r,n))}else s=new i(t.type);return s.initialize(e.util.shallow_merge(c.defaults||{},t.attrs||{})),s.get("id")||s.set("id",this.uniqueId()),c.controller&&this.eventEngine.add(s,c.controller,n),s},n}()})}.call(this),function(){e("build/Command",["dou"],function(t){"use strict";var e;return e=function(){function e(e){this.params=t.util.clone(e)}return e.prototype.execute=function(){},e.prototype.unexecute=function(){},e}()})}.call(this),function(){e("build/CommandManager",["./Command"],function(t){"use strict";var e;return e=function(){function e(){this.reset()}return e.prototype.despose=function(){return this.reset()},e.prototype.execute=function(e){return!e instanceof t?void 0:(e.execute(),this.exq.push(e),this.uxq=[])},e.prototype.undo=function(){var t;return t=this.exq.pop(),t?(t.unexecute(),this.uxq.push(t)):void 0},e.prototype.redo=function(){var t;return t=this.uxq.pop(),t?(t.execute(),this.exq.push(t)):void 0},e.prototype.undoable=function(){return this.exq.length>0},e.prototype.redoable=function(){return this.uxq.length>0},e.prototype.reset=function(){return this.exq=[],this.uxq=[]},e}()})}.call(this),function(){var t={}.hasOwnProperty;e("build/ComponentRegistry",["dou"],function(e){"use strict";var n;return n=function(){function n(){this.componentSpecs={}}return n.prototype.despose=function(){var t,e,n,i,o;for(t=Object.keys(this.componentSpecs),o=[],n=0,i=t.length;i>n;n++)e=t[n],o.push(this.unregister(e));return o},n.prototype.setRegisterCallback=function(t,e){return this.callback_register="function"==typeof t?t.bind(e):void 0},n.prototype.setUnregisterCallback=function(t,e){return this.callback_unregister="function"==typeof t?t.bind(e):void 0},n.prototype.register=function(t){var e,n,i;if(!this.componentSpecs[t.type]){if(t.dependencies){i=t.dependencies;for(n in i)e=i[n],this.register(e)}return this.componentSpecs[t.type]=t,this.callback_register?this.callback_register(t):void 0}},n.prototype.unregister=function(t){var e;return(e=this.componentSpecs[t])?(delete this.componentSpecs[t],this.callback_unregister&&this.callback_unregister(e),e):void 0},n.prototype.forEach=function(e,n){var i,o,r,s;r=this.componentSpecs,s=[];for(i in r)t.call(r,i)&&(o=r[i],s.push(e.call(n,i,o)));return s},n.prototype.list=function(){return Object.keys(this.componentSpecs).map(function(t){return this.componentSpecs[t]},this)},n.prototype.get=function(t){var n;return n=this.componentSpecs[t],n?e.util.clone(this.componentSpecs[t]):null},n}()})}.call(this),function(){e("build/SelectionManager",["dou"],function(t){"use strict";var e;return e=function(){function e(t){this.onselectionchange=t.onselectionchange,this.context=t.context,this.selections=[],this.selectable_fn=t.selectable_fn}return e.prototype.focus=function(e){var n,i;return e?(n=this.selections.indexOf(e),n>-1?(i=t.util.clone(this.selections),this.selections.splice(n,1),this.selections.unshift(e),this.onselectionchange?this.onselectionchange.call(this.context,{added:[],removed:[],before:i,after:this.selections}):void 0):this.toggle(e)):this.selections[0]},e.prototype.get=function(){return t.util.clone(this.selections)},e.prototype.toggle=function(e){var n,i,o,r;if(e)return o=t.util.clone(this.selections),i=this.selections.indexOf(e),i>-1?r=this.selections.splice(i,1):(n=[e],this.selections.unshift(e)),this.onselectionchange?this.onselectionchange.call(this.context,{added:n||[],removed:r||[],before:o,after:this.selections}):void 0},e.prototype.select=function(e){var n,i,o,r;return o=t.util.clone(this.selections),e instanceof Array||(e=e?[e]:[]),this.selections=function(){var t,n,o;for(o=[],t=0,n=e.length;n>t;t++)i=e[t],(!this.selectable_fn||this.selectable_fn(i))&&o.push(i);return o}.call(this),n=function(){var t,e,n,r;for(n=this.selections,r=[],t=0,e=n.length;e>t;t++)i=n[t],-1===o.indexOf(i)&&r.push(i);return r}.call(this),r=function(){var t,e,n;for(n=[],t=0,e=o.length;e>t;t++)i=o[t],-1===this.selections.indexOf(i)&&n.push(i);return n}.call(this),this.onselectionchange&&(n.length>0||r.length>0)?this.onselectionchange.call(this.context,{added:n,removed:r,before:o,after:this.selections}):void 0},e.prototype.reset=function(){var t;return t=this.selections,this.selections=[],t.length>0&&this.onselectionchange?this.onselectionchange.call(this.context,{added:[],removed:t,before:t,after:this.selections}):void 0},e}()})}.call(this),function(){e("build/ComponentSpec",["dou"],function(){"use strict";var t;return t=function(){function t(t){this.urn=t.urn,this.name=t.name,this.description=t.description,this.defaults=t.defaults,this.view_factory=t.view_factory,this.handle_factory=t.handle_factory,this.toolbox_image=t.toolbox_image}return t}()})}.call(this),function(){e("build/spec/SpecInfographic",["dou","KineticJS"],function(t,e){"use strict";var n,i;return i=function(t){return new e.Group(t)},n=function(t){return new Kin.Group(t)},{type:"infographic",name:"infographic",containable:!0,container_type:"container",description:"Infographic Specification",defaults:{draggable:!1},view_factory_fn:i,handle_factory_fn:n,toolbox_image:"images/toolbox_infographic.png"}})}.call(this),function(){var t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e("build/command/CommandPropertyChange",["dou","../Command"],function(t,e){"use strict";var i;return i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.execute=function(){var t,e,n,i,o;for(i=this.params.changes,o=[],e=0,n=i.length;n>e;e++)t=i[e],t.property?o.push(t.component.set(t.property,t.after)):o.push(t.component.set(t.after));return o},e.prototype.unexecute=function(){var t,e,n,i,o;for(i=this.params.changes,o=[],e=0,n=i.length;n>e;e++)t=i[e],t.property?o.push(t.component.set(t.property,t.before)):o.push(t.component.set(t.before));return o},e}(e)})}.call(this),function(){e("build/spec/SpecContentEditLayer",["dou","KineticJS","../EventTracker","../ComponentSelector","../command/CommandPropertyChange"],function(t,e,n,i,o){"use strict";var r,s,c,a,h,u,l,p,f,d,g,_,m,v,y;return s=function(t){var n,i,o,r;return o=this.getView().getStage(),i=t.offset||{x:0,y:0},r=new e.Layer(t),n=new e.Rect({name:"background for ruler-layer",draggable:!0,listening:!0,x:0,y:0,width:Math.min(o.width()+i.x,o.width()),height:Math.min(o.height()+i.y,o.height()),stroke:t.stroke,fill:"cyan",opacity:.1}),r.add(n),r.__background__=n,r},y=function(t,e,n){switch(t){case"MOVE":n.__background__.moveToTop();break;case"SELECT":n.__background__.moveToBottom()}return n.batchDraw()},c=function(t,e,n,i){var o,r,s;return o=this,r=i.listener,s=o.getAttachedViews(r)[0],y(o.getEditMode(),null,s,r,o)},_=function(){},u=function(t,e,n){var i;return i=n.listener,e&&i.remove(e),t?i.add(t):void 0},l=function(t){var e;return e=this,t.length>0?console.log("selection-changed",t[0],e.getAttachedModel(t[0])):void 0},a=function(){},g=function(t){var n,i,o,r,s,c;if(i=this.context,s=this.listener,n=s.__background__,o=t.targetNode,this.context.selectionManager.select(o),!t.targetNode||t.targetNode===n){switch(c=s.offset(),n.setAttrs({x:c.x+20,y:c.y+20}),this.start_point={x:t.clientX,y:t.clientY},this.origin_offset=s.offset(),r={x:this.start_point.x+this.origin_offset.x,y:this.start_point.y+this.origin_offset.y},i.getEditMode()){case"SELECT":this.selectbox=new e.Rect({stroke:"black",strokeWidth:1,dash:[3,3]}),s.add(this.selectbox),this.selectbox.setAttrs(r);break;case"MOVE":}return s.draw(),t.cancelBubble=!0}},d=function(t){var e,n,i,o,r;if(n=this.context,i=this.listener,e=i.__background__,!t.targetNode||t.targetNode===e){switch(n.getEditMode()){case"SELECT":e.setAttrs({x:this.origin_offset.x+20,y:this.origin_offset.y+20}),this.selectbox.setAttrs({width:t.clientX-this.start_point.x,height:t.clientY-this.start_point.y});break;case"MOVE":o=this.origin_offset.x-(t.clientX-this.start_point.x),r=this.origin_offset.y-(t.clientY-this.start_point.y),i.offset({x:o,y:r}),e.setAttrs({x:o+20,y:r+20}),i.fire("change-offset",{x:o,y:r},!1)}return i.batchDraw(),t.cancelBubble=!0}},f=function(t){var e,n,i,r,s,c,a,h;if(i=this.context,s=t.targetNode,r=i.getAttachedModel(s),r&&(n=new o({changes:[{component:r,before:{x:r.get("x"),y:r.get("y")},after:{x:s.x(),y:s.y()}}]}),i.execute(n)),c=this.listener,e=c.__background__,!t.targetNode||t.targetNode===e){switch(i.getEditMode()){case"SELECT":e.setAttrs({x:this.origin_offset.x+20,y:this.origin_offset.y+20}),this.selectbox.remove(),delete this.selectbox;break;case"MOVE":a=Math.max(this.origin_offset.x-(t.clientX-this.start_point.x),-20),h=Math.max(this.origin_offset.y-(t.clientY-this.start_point.y),-20),c.offset({x:a,y:h}),e.setAttrs({x:a+20,y:h+20}),c.fire("change-offset",{x:a,y:h},!1)}return c.draw(),t.cancelBubble=!0}},p=function(t){var e;return e=t.targetNode,this.context.selectionManager.select(e)},m=function(t){var e,n;return n=this.listener,e=n.__background__,e.setSize(t.after),n.batchDraw()},h=function(t,e,n){var i,o,r;return i=this,o=n.listener,r=i.getAttachedViews(o)[0],y(t,e,r,o,i)},r={"(root)":{"(root)":{"change-model":u,"change-selections":l,"change-edit-mode":h}},"(self)":{"(self)":{added:c,removed:_},"(all)":{change:a}}},v={"(self)":{dragstart:g,dragmove:d,dragend:f,click:p},"(root)":{resize:m}},{type:"content-edit-layer",name:"content-edit-layer",containable:!0,container_type:"layer",description:"Selection Edit Layer Specification",defaults:{listening:!0,draggable:!1},controller:r,view_listener:v,view_factory_fn:s,toolbox_image:"images/toolbox_content_edit_layer.png"}})}.call(this),function(){e("build/spec/SpecGuideLayer",["KineticJS"],function(t){"use strict";var e,n,i,o,r,s,c,a,h;return n=function(e){return new t.Layer(e)},o=function(e,n,i,o){var r,s,c,a,h;return r=this,s=o.listener,h=r.getAttachedViews(s)[0],a=s._track=s._track||{},a.changes=(a.changes||0)+1,a.text||(a.text=new t.Text({x:10,y:10,listening:!1,fontSize:12,fontFamily:"Calibri",fill:"green"}),h.add(a.text)),c="[ PropertyChange ] "+e.type+" : "+e.get("id")+"\n[ Before ] "+JSON.stringify(n)+"\n[ After ] "+JSON.stringify(i),a.text.setAttr("text",c),h.draw(),setTimeout(function(){var e;if(!(--a.changes>0))return e=new Kinetic.Tween({node:a.text,opacity:0,duration:1,easing:t.Easings.EaseOut}),e.play(),setTimeout(function(){return a.changes>0?(e.reset(),e.destroy(),void 0):(e.finish(),e.destroy(),a.text.remove(),delete a.text,h.draw())},1e3)},5e3)},c=function(e){var n,i,o,r,s,c,a,h;return a=this.listener,r=a.getStage(),this.width=r.getWidth(),this.height=r.getHeight(),this.mouse_origin={x:e.x,y:e.y},n=e.targetNode,this.node_origin=n.getAbsolutePosition(),h=a.offset(),i=this.node_origin.x+h.x,o=this.node_origin.y+h.y,this.vert=new t.Line({stroke:"red",tension:1,points:[i,0,i,this.height]}),this.hori=new t.Line({stroke:"red",tension:1,points:[0,o,this.width,o]}),this.text=new t.Text({listening:!1,fontSize:12,fontFamily:"Calibri",fill:"green"}),this.text.setAttr("text","[ "+i+"("+n.x()+"), "+o+"("+n.y()+") ]"),s=Math.max(i,0)>this.text.width()+10?i-(this.text.width()+10):Math.max(i+10,10),c=Math.max(o,0)>this.text.height()+10?o-(this.text.height()+10):Math.max(o+10,10),this.text.setAttrs({x:s,y:c}),a.add(this.vert),a.add(this.hori),a.add(this.text),a.batchDraw()},s=function(t){var e,n,i,o,r,s,c,a,h,u;return c=this.listener,n={x:t.x-this.mouse_origin.x+this.node_origin.x,y:t.y-this.mouse_origin.y+this.node_origin.y},h=10*Math.round(n.x/10),u=10*Math.round(n.y/10),e=t.targetNode,e.setAbsolutePosition({x:h,y:u}),a=c.offset(),i=h+a.x,o=u+a.y,this.vert.setAttrs({points:[i,0,i,this.height]}),this.hori.setAttrs({points:[0,o,this.width,o]}),this.text.setAttr("text","[ "+i+"("+e.x()+"), "+o+"("+e.y()+") ]"),r=Math.max(i,0)>this.text.width()+10?i-(this.text.width()+10):Math.max(i+10,10),s=Math.max(o,0)>this.text.height()+10?o-(this.text.height()+10):Math.max(o+10,10),this.text.setAttrs({x:r,y:s}),c.draw()},r=function(){var t;return t=this.listener,this.vert.remove(),this.hori.remove(),this.text.remove(),t.draw()},i=function(){},a=function(){var t,e;return t=this,e=t.getView(),this.getEventHandler().off(e,guide_handler)},e={"(root)":{"(all)":{change:o}},"(self)":{"(self)":{added:i,removed:a}}},h={"(root)":{dragstart:c,dragmove:s,dragend:r}},{type:"guide-layer",name:"guide-layer",containable:!0,container_type:"layer",description:"Editing Guide Specification",defaults:{draggable:!1},controller:e,view_listener:h,view_factory_fn:n,toolbox_image:"images/toolbox_guide_layer.png"}})}.call(this),function(){e("build/spec/SpecRulerLayer",["dou","KineticJS"],function(t,e){"use strict";var n,i,o,r,s,c;return i=function(t){return new e.Layer(t)},r=function(t){var e,n;return n=this.listener,n.__hori__||(e=n.getChildren().toArray(),n.__hori__=e[0],n.__vert__=e[1]),n.__hori__.setAttr("zeropos",-t.x),n.__vert__.setAttr("zeropos",-t.y),n.batchDraw()},s=function(t){var e,n;return n=this.listener,n.__hori__||(e=n.getChildren().toArray(),n.__hori__=e[0],n.__vert__=e[1]),n.__hori__.setSize({width:t.after.width,height:20}),n.__vert__.setSize({width:20,height:t.after.height}),n.batchDraw()},o=function(t,e,n,i){var o,r,s,c,a;return r=this,s=i.listener,a=r.getAttachedViews(s)[0],c=a.getStage(),a.__hori__||(o=a.getChildren().toArray(),a.__hori__=o[0],a.__vert__=o[1]),a.__hori__.setSize({width:c.width(),height:20}),a.__vert__.setSize({width:20,height:c.height()}),a.batchDraw()},n={"(root)":{"(self)":{added:o}}},c={"?offset_monitor_target":{"change-offset":r},"(root)":{resize:s}},{type:"ruler-layer",name:"ruler-layer",containable:!0,container_type:"layer",description:"Ruler Layer Specification",defaults:{draggable:!1},controller:n,view_listener:c,view_factory_fn:i,components:[{type:"ruler",attrs:{direction:"horizontal",name:"horizontal ruler for ruler-layer",margin:[20,0],opacity:.8,x:0,y:0,width:1e3,height:20,zeropos:20}},{type:"ruler",attrs:{direction:"vertical",name:"vertical ruler for ruler-layer",margin:[20,0],opacity:.8,x:0,y:0,width:20,height:1e3,zeropos:20}}],toolbox_image:"images/toolbox_ruler_layer.png"}})}.call(this),function(){e("build/spec/SpecHandleLayer",["dou","KineticJS"],function(t,e){"use strict";var n,i,o,r,s,c,a;return i=function(t){var n;return n=new e.Layer(t),n.handles={},n},o=function(t){var e;return e=this.listener,e.offset({x:t.x,y:t.y}),e.batchDraw()},c=function(t){var e,n,i;return i=this.listener,n=t.targetNode.getAttr("id"),e=i.handles[n],e?(e.setAbsolutePosition(t.targetNode.getAbsolutePosition()),i.batchDraw()):void 0},s=function(t){var e,n,i;return i=this.listener,n=t.targetNode.getAttr("id"),e=i.handles[n],e?(e.setAbsolutePosition(t.targetNode.getAbsolutePosition()),i.draw()):void 0},r=function(t,e,n,i,o){var r,s,c,a,h,u,l,p,f,d,g,_,m;for(r=this,u=o.listener,f=r.getAttachedViews(u)[0],d=0,_=i.length;_>d;d++)l=i[d],h=l.getAttr("id"),s=f.handles[h],c=r.getAttachedModel(s),u.remove(c),delete f.handles[h];for(g=0,m=n.length;m>g;g++)l=n[g],h=l.getAttr("id"),p=l.getAbsolutePosition(),c=this.createComponent({type:"handle-checker",attrs:{}}),u.add(c),a=r.getAttachedViews(c)[0],a.setAbsolutePosition(p),f.handles[h]=a;return f.batchDraw()},n={"(root)":{"(root)":{"change-selections":r}}},a={"?offset_monitor_target":{"change-offset":o,dragmove:c,dragend:s}},{type:"handle-layer",name:"handle-layer",containable:!0,container_type:"layer",description:"Handle Layer Specification",defaults:{draggable:!1},controller:n,view_listener:a,view_factory_fn:i,toolbox_image:"images/toolbox_handle_layer.png"}})}.call(this),function(){e("build/spec/SpecGroup",["dou","KineticJS"],function(t,e){"use strict";var n,i,o;return o=function(t){return t.targetNode&&t.targetNode!==this.__background__?void 0:t.targetNode=this},i=function(n){var i,r;return r=new e.Group(n),i=new e.Rect(t.util.shallow_merge({},n,{draggable:!1,listening:!0,x:0,y:0,id:void 0})),r.add(i),n.draggable&&(r.on("dragstart dragmove dragend",o),r.__background__=i),r},n=function(t){return new Kin.Group(t)},{type:"group",name:"group",containable:!0,container_type:"container",description:"Group Specification",defaults:{width:100,height:50,stroke:"black",strokeWidth:4,draggable:!0,listening:!0,opacity:1},view_factory_fn:i,handle_factory_fn:n,toolbox_image:"images/toolbox_group.png"}})}.call(this),function(){e("build/spec/SpecRect",["KineticJS"],function(t){"use strict";var e,n;return n=function(e){return new t.Rect(e)},e=function(t){return new Kin.Rect(t)},{type:"rectangle",name:"rectangle",description:"Rectangle Specification",defaults:{width:100,height:50,fill:"green",stroke:"black",strokeWidth:4},view_factory_fn:n,handle_factory_fn:e,toolbox_image:"images/toolbox_rectangle.png"}})}.call(this),function(){e("build/spec/SpecRing",["KineticJS"],function(t){"use strict";var e,n;return n=function(e){return new t.Ring(e)},e=function(t){return new Kin.Ring(t)},{type:"ring",name:"ring",description:"Ring Specification",defaults:{innerRadius:40,outerRadius:80,fill:"red",stroke:"black",strokeWidth:5},view_factory_fn:n,handle_factory_fn:e,toolbox_image:"images/toolbox_ring.png"}})}.call(this),function(){e("build/spec/SpecRuler",["KineticJS"],function(){"use strict";var t,e,n,i,o,r;return t=3.779527559,o=function(e){var n,i,o,r,s,c,a,h,u,l,p,f,d,g,_,m,v,y,w,x;for(l=parseInt(this.getAttr("zeropos")),r=this.getAttr("margin")[0],s=this.width()-this.getAttr("margin")[1],n=this.height()-15,i=this.height(),e.beginPath(),e.moveTo(0,0),e.lineTo(0,this.height()),e.lineTo(this.width(),this.height()),e.lineTo(this.width(),0),e.lineTo(0,0),u=this.width()-l,h=Math.ceil(u/t),o=f=0,m=h-1;(m>=0?m>=f:f>=m)&&(p=l+o*t,!(p>s));o=m>=0?++f:--f)r>p||(0===o%10?(e.moveTo(p,n),e.lineTo(p,i)):0===o%5?(e.moveTo(p,n+8),e.lineTo(p,i)):(e.moveTo(p,n+11),e.lineTo(p,i)));for(a=l,c=Math.floor(a/t),o=d=1,v=c-1;(v>=1?v>=d:d>=v)&&(p=l-o*t,!(r>p));o=v>=1?++d:--d)p>s||(0===o%10?(e.moveTo(p,n),e.lineTo(p,i)):0===o%5?(e.moveTo(p,n+8),e.lineTo(p,i)):(e.moveTo(p,n+11),e.lineTo(p,i)));for(e.closePath(),e.fillStrokeShape(this),o=g=0,y=h-1;y>=g&&(p=l+o*t,!(p>s));o=g+=10)r>p||e.strokeText(""+o/10,p+2,n+10);for(x=[],o=_=10,w=c-1;w>=_&&(p=l-o*t,!(r>p));o=_+=10)p>s||x.push(e.strokeText("-"+o/10,p+2,n+10));return x},r=function(e){var n,i,o,r,s,c,a,h,u,l,p,f,d,g,_,m,v,y,w,x;for(l=parseInt(this.getAttr("zeropos")),s=this.getAttr("margin")[0],r=this.height()-this.getAttr("margin")[1],n=this.width()-15,i=this.width(),e.beginPath(),e.moveTo(0,0),e.lineTo(0,this.height()),e.lineTo(this.width(),this.height()),e.lineTo(this.width(),0),e.lineTo(0,0),h=this.height()-l,u=Math.ceil(h/t),o=f=0,m=u-1;(m>=0?m>=f:f>=m)&&(p=l+o*t,!(p>r));o=m>=0?++f:--f)s>p||(0===o%10?(e.moveTo(n,p),e.lineTo(i,p)):0===o%5?(e.moveTo(n+8,p),e.lineTo(i,p)):(e.moveTo(n+11,p),e.lineTo(i,p)));for(c=l,a=Math.floor(c/t),o=d=1,v=a-1;v>=1?v>=d:d>=v;o=v>=1?++d:--d)if(p=l-o*t,!(p>r)){if(s>p)break;0===o%10?(e.moveTo(n,p),e.lineTo(i,p)):0===o%5?(e.moveTo(n+8,p),e.lineTo(i,p)):(e.moveTo(n+11,p),e.lineTo(i,p))}for(e.closePath(),e.fillStrokeShape(this),o=g=0,y=u-1;y>=g&&(p=l+o*t,!(p>r));o=g+=10)s>p||e.strokeText(""+o/10,1,p+10);for(x=[],o=_=10,w=a-1;w>=_&&(p=l-o*t,!(s>p));o=_+=10)p>r||x.push(e.strokeText("-"+o/10,1,p+10));return x},i=function(){return"vertical"!==this.getAttr("direction")?o.apply(this,arguments):r.apply(this,arguments)},n=function(t){return new Kinetic.Shape(t)},e=function(t){return new Kin.Rect(t)},{type:"ruler",name:"ruler",description:"Ruler Specification",defaults:{drawFunc:i,fill:"#848586",stroke:"#C2C3C5",strokeWidth:.5,width:100,height:50,margin:[15,15],zeropos:15,direction:"horizontal",font:"8px Verdana"},view_factory_fn:n,handle_factory_fn:e,toolbox_image:"images/toolbox_ruler.png"}
})}.call(this),function(){e("build/spec/SpecImage",["KineticJS"],function(t){"use strict";var e,n,i,o;return i=function(e){var n,i;return n=new t.Image(e),i=new Image,i.onload=function(){return n.getLayer().draw()},i.src=e.url,n.setImage(i),n},n=function(t){return new Kin.Image(t)},e={"(self)":{"(self)":{change:function(t,n,i){var o,r;if(n.url||i.url)return e=this,r=e.getAttachedViews(t)[0],o=r.getImage(),o.src=i.url}}}},o={"(self)":{click:function(){var t,n;return e=this.context,n=this.listener,t=e.getAttachedModel(n),this.count=this.count?++this.count:1,this.count%2?t.set("url","http://www.baidu.com/img/bdlogo.gif"):t.set("url","http://i.cdn.turner.com/cnn/.e/img/3.0/global/header/intl/CNNi_Logo.png")}}},{type:"image",name:"image",description:"Image Specification",defaults:{width:100,height:50,stroke:"black",strokeWidth:1,rotationDeg:0,draggable:!0},controller:e,view_listener:o,view_factory_fn:i,handle_factory_fn:n,toolbox_image:"images/toolbox_image.png"}})}.call(this),function(){e("build/spec/SpecText",["KineticJS"],function(t){"use strict";var e,n;return n=function(e){return new t.Text(e)},e=function(t){return new Kin.Text(t)},{type:"text",name:"text",description:"Text Specification",defaults:{width:"auto",height:"auto",draggable:!0,strokeWidth:1,fontSize:40,fontFamily:"Arial",fontStyle:"normal",fill:"black",stroke:"black",text:"TEXT",rotationDeg:0},view_factory_fn:n,handle_factory_fn:e,toolbox_image:"images/toolbox_text.png"}})}.call(this),function(){e("build/spec/SpecStar",["KineticJS"],function(t){"use strict";var e,n;return n=function(e){return new t.Star(e)},e=function(t){return new Kin.Star(t)},{type:"star",name:"star",description:"Star Specification",defaults:{width:100,height:50,numPoints:5,innerRadius:35,outerRadius:70,fill:"red",stroke:"black",strokeWidth:4},view_factory_fn:n,handle_factory_fn:e,toolbox_image:"images/toolbox_star.png"}})}.call(this),function(){e("build/spec/SpecBarcode",["bwip","KineticJS"],function(t,e){"use strict";var n,i,o;return o=function(n){var i,o;return o=new e.Image({x:n.x,y:n.y,draggable:!0,id:n.id}),i=new Image,i.onload=function(){return o.setAttrs({width:i.width,height:i.height}),o.getLayer().draw()},i.src=t.imageUrl({symbol:n.symbol,text:n.text,alttext:n.alttext,scale_h:n.scale_h,scale_w:n.scale_w,rotation:n.rotation}),o.setImage(i),o},i=function(t){return new Kin.Image(t)},n={"(self)":{"(self)":{change:function(e,i,o){var r,s,c;if(!o.x&&!o.y)return n=this,c=n.getAttachedViews()[0],s=t.imageUrl({symbol:e.get("symbol"),text:e.get("text"),alttext:e.get("alttext"),scale_h:e.get("scale_h"),scale_w:e.get("scale_w"),rotation:e.get("rotation")}),r=c.getImage(),r.src=s}}}},{type:"barcode",name:"barcode",description:"Barcode Specification",defaults:{width:100,height:50,stroke:"black",strokeWidth:1,rotationDeg:0,draggable:!0},controller:n,view_factory_fn:o,handle_factory_fn:i,toolbox_image:"images/toolbox_barcode.png"}})}.call(this),function(){e("build/handle/HandleChecker",["dou","KineticJS"],function(t,e){"use strict";var n,i;return i=function(n){var i,o;return o=["red","black","yellow","cyan"],i=Math.floor(10*Math.random())%o.length,new e.Rect(t.util.shallow_merge(n,{fill:o[i]}))},n=function(t){return new Kin.Rect(t)},{type:"handle-checker",name:"handle-checker",description:"Checker Handle Specification",defaults:{width:10,height:10,fill:"red",stroke:"black",strokeWidth:2},view_factory_fn:i,handle_factory_fn:n,toolbox_image:"images/toolbox_handle_checker.png"}})}.call(this),function(){e("build/spec/SpecPainter",["KineticJS","./SpecInfographic","./SpecContentEditLayer","./SpecGuideLayer","./SpecRulerLayer","./SpecHandleLayer","./SpecGroup","./SpecRect","./SpecRing","./SpecRuler","./SpecImage","./SpecText","./SpecStar","./SpecBarcode","../handle/HandleChecker"],function(t,e,n,i,o,r,s,c,a,h,u,l,p,f,d){"use strict";var g,_;return _=function(e){return new t.Stage(e)},g={type:"painter-app",name:"painter-app",containable:!0,container_type:"application",description:"Painter Application Specification",defaults:{},controller:g,view_factory_fn:_,dependencies:{infographic:e,"content-edit-layer":n,"guide-layer":i,"ruler-layer":o,"handle-layer":r,group:s,rect:c,ring:a,ruler:h,image:u,text:l,star:p,barcode:f,"handle-checker":d},layers:[{type:"content-edit-layer",attrs:{offset:{x:-20,y:-20}}},{type:"handle-layer",attrs:{offset_monitor_target:"content-edit-layer",offset:{x:-20,y:-20}}},{type:"guide-layer",attrs:{offset:{x:-20,y:-20}}},{type:"ruler-layer",attrs:{offset_monitor_target:"content-edit-layer"}}],toolbox_image:"images/toolbox_painter_app.png"}})}.call(this),function(){e("build/spec/SpecContentViewLayer",["KineticJS","../EventTracker","../ComponentSelector","../command/CommandPropertyChange"],function(t){"use strict";var e,n,i,o,r,s,c;return n=function(e){return new t.Layer(e)},i=function(){},s=function(){},r=function(t,e){var n,i,o,r,s;for(r=this.findComponent("content-view-layer"),s=[],i=0,o=r.length;o>i;i++)n=r[i],e&&n.remove(e),t&&n.add(t),s.push(this.findView("#"+n.get("id")));return s},o=function(t,e,n){var i;return i=this.findViewByComponent(t),i.setAttrs(n),this.drawView()},e={"(root)":{"(root)":{"change-model":r}},"(self)":{"(all)":{change:o},"(self)":{change:o}}},c={click:function(t){var e;return e=t.targetNode,this.selectionManager.select(e)}},{type:"content-view-layer",name:"content-view-layer",containable:!0,container_type:"layer",description:"Content View Layer Specification",defaults:{},controller:e,view_listener:c,view_factory_fn:n,toolbox_image:"images/toolbox_content_view_layer.png"}})}.call(this),function(){e("build/spec/SpecPresenter",["KineticJS","./SpecInfographic","./SpecContentViewLayer","./SpecGroup","./SpecRect","./SpecRing","./SpecRuler"],function(t,e,n,i,o,r,s){"use strict";var c,a;return a=function(e){return new t.Stage(e)},c={type:"presenter-app",name:"presenter-app",containable:!0,container_type:"application",description:"Presenter Application Specification",defaults:{},controller:c,view_factory_fn:a,dependencies:{infographic:e,"content-view-layer":n,group:i,rect:o,ring:r,ruler:s},layers:[{type:"content-view-layer",attrs:{}}],toolbox_image:"images/toolbox_presenter_app.png"}})}.call(this),function(){var t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e("build/command/CommandMove",["dou","../Command"],function(t,e){"use strict";var i;return i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.execute=function(){var t,e,n;switch(e=this.params.to,t=this.params.model,n=this.params.view,this.i_model=t.getContainer().indexOf(t),this.i_view=n.getZIndex(),e){case"UP":n.moveUp(),t.moveUp();break;case"DOWN":n.moveDown(),t.moveDown();break;case"TOP":n.moveToTop(),t.moveToTop();break;case"BOTTOM":n.moveToBottom(),t.moveToBottom()}return n.getLayer().draw()},e.prototype.unexecute=function(){var t,e,n;switch(e=this.params.to,t=this.params.model,n=this.params.view,e){case"UP":n.moveDown(),t.moveDown();break;case"DOWN":n.moveUp(),t.moveUp();break;case"TOP":n.setZIndex(this.i_view),t.moveAt(this.i_model);break;case"BOTTOM":n.setZIndex(this.i_view),t.moveAt(this.i_model)}return n.getLayer().draw()},e}(e)})}.call(this),function(){e("build/ApplicationContext",["dou","KineticJS","./MVCMixin","./Component","./Container","./EventEngine","./EventTracker","./ComponentFactory","./Command","./CommandManager","./ComponentRegistry","./ComponentSelector","./SelectionManager","./ComponentSpec","./spec/SpecPainter","./spec/SpecPresenter","./spec/SpecInfographic","./command/CommandMove"],function(t,e,n,i,o,r,s,c,a,h,u,l,p,f,d,g,_,m){"use strict";var v;return v=function(){function t(t){var e,n,i,o,a,f,d,g;if(this.application_spec=t.application_spec,i=t.container,"string"!=typeof i)throw new Error("container is a mandatory string type option.");if(!this.application_spec)throw new Error("application_spec is a mandatory option");if(this.commandManager=new h,this.selectionManager=new p({onselectionchange:this.onselectionchange,context:this,selectable_fn:function(t){return t.getAttr("id")}}),this.compEventTracker=new s,this.viewEventTracker=new s,this.eventEngine=new r,this.componentRegistry=new u,this.componentRegistry.setRegisterCallback(function(){},this),this.componentRegistry.setUnregisterCallback(function(){},this),this.componentFactory=new c(this.componentRegistry,this.eventEngine,this.viewEventTracker),this.componentRegistry.register(this.application_spec),e={id:"application",container:t.container,width:t.width,height:t.height},this.application=this.componentFactory.createComponent({type:this.application_spec.type,attrs:e},this),this.view=this.componentFactory.createView(this.application,this),this.eventEngine.setRoot(this.application),a=this.view,o=this.application,this.compEventTracker.setSelector({select:function(t,e){return CompoentSelector.select(t,o,e)}}),this.viewEventTracker.setSelector({select:function(t,e){var n,i,r,s,c,h,u,p,f;if("(self)"===t)return e;if("(root)"===t)return a;for(i=l.select(t,o),s=[],c=0,u=i.length;u>c;c++)for(n=i[c],f=n.getViews(),h=0,p=f.length;p>h;h++)r=f[h],s.push(r);return s}}),this.application.on("add",this.onadd,this),this.application.on("remove",this.onremove,this),this.application_spec.layers)for(g=this.application_spec.layers,f=0,d=g.length;d>f;f++)n=g[f],this.application.add(this.componentFactory.createComponent(n,this))}return t.prototype.despose=function(){return this.compEventTracker.despose(),this.eventController.despose(),this.eventRegistry.despose(),this.componentFactory.despose()},t.prototype.getEventTracker=function(){return this.compEventTracker},t.prototype.getView=function(){return this.view},t.prototype.getModel=function(){return this.model},t.prototype.setModel=function(t){var e;return e=this.model,this.model=t,this.application.trigger("change-model",this.model,e)},t.prototype.getController=function(){return this.eventController},t.prototype.getApplication=function(){return this.application},t.prototype.findComponent=function(t){return l.select(t,this.application)},t.prototype.findView=function(t){return this.view.find(t)},t.prototype.findViewByComponent=function(t){return this.view.find("#"+t.get("id"))},t.prototype.createView=function(t){return this.componentFactory.createView(t,this)},t.prototype.createComponent=function(t){return this.componentFactory.createComponent(t,this)},t.prototype.drawView=function(){return this.view.draw()},t.prototype.execute=function(t){return this.commandManager.execute(t)},t.prototype.setSize=function(t,e){var n;return n=this.view.getSize(),this.view.setSize({width:t,height:e}),this.view.fire("resize",{before:n,after:{width:t,height:e}})},t.prototype.setEditMode=function(t){var e;return e=this.editMode||"SELECT",e!==t?(this.editMode=t,this.application.trigger("change-edit-mode",t,e)):void 0},t.prototype.getEditMode=function(){return this.editMode?this.editMode:"SELECT"},t.prototype.onadd=function(t,e){var n,i;return i=t===this.application?this.view:this.findViewByComponent(t),n=this.createView(e),i.add(n),this.drawView()},t.prototype.onremove=function(t,e){var n;return console.log("removed",t,e),n=this.findViewByComponent(e),n.destroy(),this.drawView()},t.prototype.onselectionchange=function(t){return this.application.trigger("change-selections",t.after,t.before,t.added,t.removed)},t.prototype._move=function(){var t;return(t=this.selectionManager.focus())?this.execute(new m({to:"UP",view:t,model:this.getAttachedModel(t)})):void 0},t.prototype.moveUp=function(){return this._move("UP")},t.prototype.moveDown=function(){return this._move("DOWN")},t.prototype.moveToTop=function(){return this._move("TOP")},t.prototype.moveToBottom=function(){return this._move("BOTTOM")},t}(),t.mixin(v,n.controller),v})}.call(this),function(){var t=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};e("build/Module",[],function(){var e,n;return n=["extended","included"],e=function(){function e(){}return e.extend=function(e){var i,o,r;for(i in e)o=e[i],t.call(n,i)<0&&(this[i]=o);return null!=(r=e.extended)&&r.apply(this),this},e.include=function(e){var i,o,r;for(i in e)o=e[i],t.call(n,i)<0&&(this.prototype[i]=o);return null!=(r=e.included)&&r.apply(this),this},e}()})}.call(this),function(){e("build/infopik",["./ApplicationContext","./Command","./CommandManager","./command/CommandPropertyChange","./Component","./ComponentFactory","./ComponentRegistry","./ComponentSelector","./ComponentSpec","./Container","./EventEngine","./EventPump","./EventTracker","./Module","./MVCMixin","./SelectionManager","./handle/HandleChecker","./spec/SpecBarcode","./spec/SpecContentEditLayer","./spec/SpecContentViewLayer","./spec/SpecGroup","./spec/SpecGuideLayer","./spec/SpecHandleLayer","./spec/SpecImage","./spec/SpecInfographic","./spec/SpecPainter","./spec/SpecPresenter","./spec/SpecRect","./spec/SpecRing","./spec/SpecRuler","./spec/SpecRulerLayer","./spec/SpecStar","./spec/SpecText"],function(t,e,n,i,o,r,s,c,a,h,u,l,p,f,d,g,_,m,v,y,w,x,b,S,C,k,T,A,M,E,P,R){"use strict";return{app:function(e){return new t(e)},spec:{painter:k,presenter:T,rect:A,ring:M,ruler:E,star:R,infographic:C,barcode:m,image:S,group:w}}})}.call(this),t.infopik=n("build/infopik")}(this);