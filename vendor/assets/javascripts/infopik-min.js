/*! Infopik v0.0.0 | (c) Hatio, Lab. | MIT License */
!function(t){function n(){var t,n,e=Array.prototype.slice.call(arguments),o=[];"string"==typeof e[0]&&(t=e.shift()),i(e[0])&&(o=e.shift()),n=e.shift(),r[t]=[o,n]}function e(t){function n(n){var e=t.split("/"),r=n.split("/"),o=!1;for(e.pop();".."==r[0]&&e.length;)e.pop(),r.shift(),o=!0;return"."==r[0]&&(r.shift(),o=!0),o&&(r=e.concat(r)),r.join("/")}var i,c,p;return"undefined"==typeof o[t]&&(i=r[t],i&&(p=i[0],c=i[1],o[t]=c.apply(void 0,s(p,function(t){return e(n(t))})))),o[t]}var r={},o={},i=Array.isArray||function(t){return t.constructor==Array},s=Array.map||function(t,n,e){for(var r=0,o=t.length,i=[];o>r;r++)i.push(n.call(e,t[r]));return i};!function(){n("src/Component",["dou"],function(t){"use strict";var n;return n=function(){function t(t){this.type=t}return t}(),t.mixin(n,[t["with"].advice,t["with"].event,t["with"].property,t["with"].lifecycle,t["with"].serialize])})}.call(this),function(){var t={}.hasOwnProperty,e=function(n,e){function r(){this.constructor=n}for(var o in e)t.call(e,o)&&(n[o]=e[o]);return r.prototype=e.prototype,n.prototype=new r,n.__super__=e.prototype,n};n("src/Container",["dou","./Component"],function(t,n){"use strict";var r,o,i,s,c,p,u,a,h;return i=function(t,e){var r;return r=t.__components__.push(e)-1,t.trigger("add",t,e,r),e instanceof n?(e.delegate_on(t),e.trigger("added",t,e,r)):void 0},a=function(t,e){var r;return r=t.__components__.indexOf(e),-1!==r&&(r>-1&&t.__components__.splice(r,1),t.trigger("remove",t,e),e instanceof n)?(e.trigger("removed",t,e),e.delegate_off(t)):void 0},o=function(t){var n,e,r;if(this.__components__||(this.__components__=[]),!(t instanceof Array))return o.call(this,[t]);if(-1===this.__components__.indexOf(n))for(e=0,r=t.length;r>e;e++)n=t[e],i(this,n);return this},u=function(t){var n,e,r;if(!(t instanceof Array))return u.call(this,[t]);if(this.__components__){for(e=0,r=t.length;r>e;e++)n=t[e],a(this,n);return this}},c=function(t){return this.__components__?this.__components__[t]:void 0},s=function(t,n){return this.__components__?this.__components__.forEach(t,n):void 0},p=function(t){return(this.__components__||[]).indexOf(t)},h=function(){return(this.__components__||[]).length},r=function(t){function n(t){n.__super__.constructor.call(this,t)}return e(n,t),n.prototype.add=o,n.prototype.remove=u,n.prototype.size=h,n.prototype.getAt=c,n.prototype.indexOf=p,n.prototype.forEach=s,n}(n),t.mixin(r,[t["with"].advice,t["with"].lifecycle])})}.call(this),function(){n("src/ComponentSelector",["dou","./Component","./Container"],function(t,n,e){"use strict";var r,o,i,s,c,p;return o=function(t,n){return t.substr(1)===n.get("id")},i=function(t,n){return t.substr(1)===n.get("name")},s=function(t,n){return"all"===t||t===n.type},r=function(t,n){switch(t.charAt(0)){case"#":return o(t,n);case".":return i(t,n);default:return s(t,n)}},p=function(t,n,r,o){return t(n,r)&&o.push(r),r instanceof e&&r.forEach(function(e){return p(t,n,e,o)}),o},c=function(t,n){var e;return e=function(){switch(t.charAt(0)){case"#":return o;case".":return i;default:return s}}(),p(e,t,n,[])},{select:c,match:r}})}.call(this),function(){var t={}.hasOwnProperty;n("src/EventController",["dou","./ComponentSelector"],function(n,e){"use strict";var r,o,i;return o=function(n,r,o){var i,s,c,p,u;u=[];for(p in n)t.call(n,p)&&(i=n[p],e.match(p,r.target)&&u.push(function(){var n;n=[];for(s in i)t.call(i,s)&&(c=i[s],s===r.name&&n.push(c.apply(this,o)));return n}.call(this)));return u},i=function(){var t,n;return t=arguments,n=t[t.length-1],this.controllers.forEach(function(e){return o.call(this,e,n,t)},this.context)},r=function(){function t(t){this.setTarget(t)}return t.prototype.setTarget=function(t){return this.target=t},t.prototype.start=function(t){return this.target.on("all",i,{context:t||null,controllers:this})},t.prototype.stop=function(){return this.target.off("all",i)},t.prototype.despose=function(){return this.stop(),this.clear(),this.target=null},t}(),n.mixin(r,n["with"].collection.withList),r})}.call(this),function(){var t={}.hasOwnProperty;n("src/EventTracker",[],function(){"use strict";var n,e;return e=function(){function n(n,e,r){var o,i;this.started=!1,n&&(this.target=n),this.handlers=e,r=r||this.target||this,this.boundhandler={};for(o in e)t.call(e,o)&&(i=e[o],"function"==typeof i&&(this.boundhandler[o]=i.bind(r)))}return n.prototype.on=function(){var n,e,r;if(!this.started){r=this.boundhandler;for(n in r)t.call(r,n)&&(e=r[n],this.target.on(n,e));return this.started=!0}},n.prototype.off=function(){var n,e,r;r=this.boundhandler;for(n in r)t.call(r,n)&&(e=r[n],this.target.off(n,e));return this.started=!1},n}(),n=function(){function t(){this.trackers=[]}return t.prototype.on=function(t,n,r){var o;return o=new e(t,n,r),this.trackers.push(o),o.on()},t.prototype.off=function(t,n){var e,r,o,i,s,c,p,u;for(o=function(){var r,o,s,c;for(s=this.trackers,c=[],e=r=0,o=s.length;o>r;e=++r)i=s[e],t!==i.target||n&&n!==i.handlers||c.push(e);return c}.call(this),p=o.reverse(),u=[],s=0,c=p.length;c>s;s++)r=p[s],u.push(this.trackers.splice(r,1)[0].off());return u},t.prototype.all=function(){var t,n,e,r,o;for(r=this.trackers,o=[],n=0,e=r.length;e>n;n++)t=r[n],o.push(t);return o},t.prototype.despose=function(){var t,n,e,r;for(r=this.trackers,n=0,e=r.length;e>n;n++)t=r[n],t.off();return this.trackers=[]},t.StandAlone=e,t}()})}.call(this),function(){n("src/ComponentFactory",["dou","./Component","./Container","./EventTracker"],function(t,n,e){"use strict";var r;return r=function(){function r(t,n){this.componentRegistry=t,this.eventTracker=n,this.seed=1}return r.prototype.despose=function(){return this.componentRegistry=null},r.prototype.uniqueId=function(){return"noid-"+this.seed++},r.prototype.createView=function(t,n){var r,o,i;if(o=t.type,r=this.componentRegistry.get(o),!r)throw new Error("Component Spec Not Found for type '"+o+"'");return i=r.view_factory_fn(t.getAll()),t instanceof e&&t.forEach(function(t){return i.add(this.createView(t))},this),r.view_listener&&this.eventTracker.on(i,r.view_listener,n),i},r.prototype.createComponent=function(r,o,i){var s,c;if(c=this.componentRegistry.get(r),!c)throw new Error("Component Spec Not Found for type '"+r+"'");return s=c.containable?new e(r):new n(r),s.initialize(t.util.shallow_merge(c.defaults||{},o||{})),s.get("id")||s.set("id",this.uniqueId()),c.component_listener&&this.eventTracker.on(s,c.component_listener,i),s},r}()})}.call(this),function(){n("src/Command",["dou"],function(t){"use strict";var n;return n=function(){function n(n){this.params=t.util.clone(n)}return n.prototype.execute=function(){},n.prototype.unexecute=function(){},n}()})}.call(this),function(){n("src/CommandManager",["src/Command"],function(t){"use strict";var n;return n=function(){function n(){this.reset()}return n.prototype.despose=function(){return this.reset()},n.prototype.execute=function(n){return!n instanceof t?void 0:(n.execute(),this.exq.push(n),this.uxq=[])},n.prototype.undo=function(){var t;return t=this.exq.pop(),t?(t.unexecute(),this.uxq.push(t)):void 0},n.prototype.redo=function(){var t;return t=this.uxq.pop(),t?(t.execute(),this.exq.push(t)):void 0},n.prototype.undoable=function(){return this.exq.length>0},n.prototype.redoable=function(){return this.uxq.length>0},n.prototype.reset=function(){return this.exq=[],this.uxq=[]},n}()})}.call(this),function(){var t={}.hasOwnProperty;n("src/ComponentRegistry",["dou","./EventController"],function(n){"use strict";var e;return e=function(){function e(){this.componentSpecs={}}return e.prototype.despose=function(){var t,n,e,r,o;for(t=Object.keys(this.componentSpecs),o=[],e=0,r=t.length;r>e;e++)n=t[e],o.push(this.unregister(n));return o},e.prototype.setRegisterCallback=function(t,n){return this.callback_register="function"==typeof t?t.bind(n):void 0},e.prototype.setUnregisterCallback=function(t,n){return this.callback_unregister="function"==typeof t?t.bind(n):void 0},e.prototype.register=function(t){var n,e,r;if(!this.componentSpecs[t.type]){if(t.dependencies){r=t.dependencies;for(e in r)n=r[e],this.register(n)}return this.componentSpecs[t.type]=t,this.callback_register?this.callback_register(t):void 0}},e.prototype.unregister=function(t){var n;return(n=this.componentSpecs[t])?(delete this.componentSpecs[t],this.callback_unregister&&this.callback_unregister(n),n):void 0},e.prototype.forEach=function(n,e){var r,o,i,s;i=this.componentSpecs,s=[];for(r in i)t.call(i,r)&&(o=i[r],s.push(n.call(e,r,o)));return s},e.prototype.list=function(){return Object.keys(this.componentSpecs).map(function(t){return this.componentSpecs[t]},this)},e.prototype.get=function(t){var e;return e=this.componentSpecs[t],e?n.util.clone(this.componentSpecs[t]):null},e}()})}.call(this),function(){n("src/ApplicationContext",["dou","KineticJS","./Component","./Container","./EventController","./EventTracker","./ComponentFactory","./CommandManager","./ComponentRegistry","./ComponentSelector"],function(t,n,e,r,o,i,s,c,p,u){"use strict";var a;return a=function(){function t(t){var n,e,r,u,a;if(this.application_spec=t.application_spec,r=t.container,"string"!=typeof r)throw new Error("container is a mandatory string type option.");if(!this.application_spec)throw new Error("application_spec is a mandatory option");if(this.commandManager=new c,this.eventTracker=new i,this.eventController=new o,this.componentRegistry=new p,this.componentRegistry.setRegisterCallback(function(t){return t.controller?this.eventController.append(t.controller):void 0},this),this.componentRegistry.setUnregisterCallback(function(t){return t.controller?this.eventController.remove(t.controller):void 0},this),this.componentFactory=new s(this.componentRegistry,this.eventTracker),this.componentRegistry.register(this.application_spec),n={id:"application",container:t.container,width:t.width,height:t.height},this.application=this.componentFactory.createComponent(this.application_spec.type,n,this),this.view=this.componentFactory.createView(this.application,this),this.eventController.setTarget(this.application),this.eventController.start(this),this.application.on("add",this.onadd,this),this.application.on("remove",this.onremove,this),this.application_spec.layers){a=this.application_spec.layers;for(u in a)e=a[u],this.application.add(this.componentFactory.createComponent(u,e,this))}}return t.prototype.despose=function(){return this.eventTracker.despose(),this.eventController.despose(),this.eventRegistry.despose(),this.componentFactory.despose()},t.prototype.getEventTracker=function(){return this.eventTracker},t.prototype.getView=function(){return this.view},t.prototype.getModel=function(){return this.model},t.prototype.setModel=function(t){var n;return n=this.model,this.model=t,this.application.trigger("change-model",this.model,n)},t.prototype.getController=function(){return this.eventController},t.prototype.getApplication=function(){return this.application},t.prototype.findComponent=function(t){return u.select(t,this.application)},t.prototype.findView=function(t){return this.view.find(t)},t.prototype.findViewByComponent=function(t){return this.view.find("#"+t.get("id"))},t.prototype.createView=function(t){return this.componentFactory.createView(t,this)},t.prototype.createComponent=function(t,n){return this.componentFactory.createComponent(t,n,this)},t.prototype.drawView=function(){return this.view.draw()},t.prototype.execute=function(t){return this.commandManager.execute(t)},t.prototype.onadd=function(t,n){var e,r;return r=t===this.application?this.view:this.findViewByComponent(t),e=this.createView(n),r.add(e),this.drawView()},t.prototype.onremove=function(t,n){var e,r;return r=t===this.application?this.view:this.findViewByComponent(t),e=this.findViewByComponent(n),r.remove(e),this.drawView()},t}()})}.call(this),function(){n("src/infopik",["./ApplicationContext"],function(t){"use strict";return{app:function(n){return new t(n)}}})}.call(this),t.infopik=e("src/infopik")}(this);