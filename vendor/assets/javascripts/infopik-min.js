/*! Infopik v0.0.0 | (c) Hatio, Lab. | MIT License */
!function(t){function e(){var t,e,n=Array.prototype.slice.call(arguments),r=[];"string"==typeof n[0]&&(t=n.shift()),o(n[0])&&(r=n.shift()),e=n.shift(),i[t]=[r,e]}function n(t){function e(e){var n=t.split("/"),i=e.split("/"),r=!1;for(n.pop();".."==i[0]&&n.length;)n.pop(),i.shift(),r=!0;return"."==i[0]&&(i.shift(),r=!0),r&&(i=n.concat(i)),i.join("/")}var o,s,c;return"undefined"==typeof r[t]&&(o=i[t],o&&(c=o[0],s=o[1],r[t]=s.apply(void 0,a(c,function(t){return n(e(t))})))),r[t]}var i={dou:[[],function(){return t.dou}],bwip:[[],function(){return t.bwip}],KineticJS:[[],function(){return t.Kinetic}]},r={},o=Array.isArray||function(t){return t.constructor==Array},a=Array.map||function(t,e,n){for(var i=0,r=t.length,o=[];r>i;i++)o.push(e.call(n,t[i]));return o};!function(){e("build/MVCMixin",["dou"],function(){"use strict";var t,e,n,i,r,o,a,s,c;return t=function(t,e,n){return e?(t.__views__||(t.__views__=[]),t.__views__.push(e),n?o(e,t,!1):void 0):void 0},n=function(t,e,n){var i;if(e&&t.__views__&&(i=t.__views__.indexOf(e),-1!==i))return t.__views__.splice(i,1),n?o(e,null,!1):void 0},e=function(t){var e,n,i,r;if(t.__views__){for(r=t.__views__,n=0,i=r.length;i>n;n++)e=r[n],o(e,null,!1);return t.__views__=null}},r=function(t){var e,n,i,r,o,a;if(e=[],!t.__views__)return e;for(o=t.__views__,a=[],i=0,r=o.length;r>i;i++)n=o[i],a.push(n);return a},o=function(e,i,r){var o;return o=e.__model__,o!==i?(o&&r&&n(o,e,!1),e.__model__=i,i&&r?t(i,e,!1):void 0):void 0},i=function(t){return t.__model__},s=function(){return this.attachView=function(e){return t(this,e,!0)},this.detachView=function(t){return n(this,t,!0)},this.detachAll=function(){return e(this)},this.getViews=function(){return r(this)}},c=function(){return this.getModel=function(){return i(this)},this.setModel=function(t){return o(this,t,!0)}},a=function(){return this.attach=function(e,n){return t(e,n,!0)},this.detach=function(t,e){return n(t,e,!0)},this.detachAll=function(t){return e(t)},this.getAttachedModel=function(t){return i(t)},this.getAttachedViews=function(t){return r(t)}},{controller:a,model:s,view:c}})}.call(this),function(){e("build/Component",["dou","./MVCMixin"],function(t,e){"use strict";var n;return n=function(){function t(t,e){this.type=t,this.container=e}return t.prototype.dispose=function(){return this.setContainer(null)},t.prototype.getContainer=function(){return this.container},t.prototype.setContainer=function(t){return t!==this.container?(this.container&&this.container.remove(this),this.container=t,this.container?this.container.add(this):void 0):void 0},t.prototype.moveAt=function(t){return this.getContainer()?this.container.moveChildAt(t,this):void 0},t.prototype.moveForward=function(){return this.getContainer()?this.container.moveChildForward(this):void 0},t.prototype.moveBackward=function(){return this.getContainer()?this.container.moveChildBackward(this):void 0},t.prototype.moveToFront=function(){return this.getContainer()?this.container.moveChildToFront(this):void 0},t.prototype.moveToBack=function(){return this.getContainer()?this.container.moveChildToBack(this):void 0},t}(),t.mixin(n,[t["with"].advice,t["with"].event,t["with"].property,t["with"].lifecycle,t["with"].serialize,t["with"].disposer,e.model])})}.call(this),function(){var t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e("build/Container",["dou","./Component"],function(t,e){"use strict";var i,r,o,a,s,c,l,u,h,p,d,f,g,_,y;return r=[],a=function(t,n){var i,r,o;if(i=n instanceof e,i&&(o=n.getContainer())){if(t===o)return;_(t,n)}return r=t.__components__.push(n)-1,i&&n.setContainer(t),t.trigger("add",t,n,r),i?(n.delegate_on(t),n.trigger("added",t,n,r)):void 0},_=function(t,n){var i,r;return i=n instanceof e,r=t.__components__.indexOf(n),-1!==r&&(r>-1&&t.__components__.splice(r,1),i&&n.setContainer(null),t.trigger("remove",t,n),n instanceof e)?(n.trigger("removed",t,n),n.delegate_off(t)):void 0},o=function(t){var e,n,i;if(this.__components__||(this.__components__=[]),!(t instanceof Array))return o.call(this,[t]);if(-1===this.__components__.indexOf(e))for(n=0,i=t.length;i>n;n++)e=t[n],a(this,e);return this},g=function(t){var e,n,i;if(!(t instanceof Array))return g.call(this,[t]);if(this.__components__){for(n=0,i=t.length;i>n;n++)e=t[n],_(this,e);return this}},c=function(t){return this.__components__?this.__components__[t]:void 0},s=function(t,e){return this.__components__?this.__components__.forEach(t,e):void 0},l=function(t){return(this.__components__||r).indexOf(t)},y=function(){return(this.__components__||r).length},u=function(t,e){var n,i,r;return i=this.indexOf(e),-1!==i?(n=this.__components__.splice(0,i),r=this.__components__.splice(1),this.__components__=n.concat(r),t=Math.max(0,t),t=Math.min(t,this.__components__.length),n=this.__components__.splice(0,t),this.__components__=n.concat(e,this.__components__)):void 0},p=function(t){var e;return e=this.indexOf(t),-1!==e&&e!==this.size()-1?(this.__components__[e]=this.__components__[e+1],this.__components__[e+1]=t):void 0},h=function(t){var e;return e=this.indexOf(t),-1!==e&&0!==e?(this.__components__[e]=this.__components__[e-1],this.__components__[e-1]=t):void 0},f=function(t){var e,n,i;return n=this.indexOf(t),-1!==n&&n!==this.size()-1?(e=this.__components__.splice(0,n),i=this.__components__.splice(1),this.__components__=e.concat(i,this.__components__)):void 0},d=function(t){var e,n,i;return n=this.indexOf(t),-1!==n&&0!==n?(e=this.__components__.splice(0,n),i=this.__components__.splice(1),this.__components__=this.__components__.concat(e,i)):void 0},i=function(e){function i(t){i.__super__.constructor.call(this,t)}return n(i,e),i.prototype.dispose=function(){var e,n,r,o;if(this.__components__){for(e=t.util.clone(this.__components__),r=0,o=e.length;o>r;r++)n=e[r],n.dispose();this.__components__=null}return i.__super__.dispose.call(this)},i.prototype.add=o,i.prototype.remove=g,i.prototype.size=y,i.prototype.getAt=c,i.prototype.indexOf=l,i.prototype.forEach=s,i.prototype.moveChildAt=u,i.prototype.moveChildForward=p,i.prototype.moveChildBackward=h,i.prototype.moveChildToFront=f,i.prototype.moveChildToBack=d,i}(e)})}.call(this),function(){e("build/ComponentSelector",["dou","./Component","./Container"],function(t,e,n){"use strict";var i,r,o,a,s,c,l;return r=function(t,e){return t.substr(1)===e.get("id")},o=function(t,e){return t.substr(1)===e.get("name")},a=function(t,e,n,i){switch(t){case"(all)":return!0;case"(self)":return n===e;case"(root)":return i===e;default:return!1}},s=function(t,e){return"all"===t||t===e.type},i=function(t,e,n,i){if("(all)"===t)return!0;switch(t.charAt(0)){case"#":return r(t,e,n,i);case".":return o(t,e,n,i);case"(":return a(t,e,n,i);default:return s(t,e,n,i)}},l=function(t,e,i,r,o,a){return t(e,i,r,o)&&a.push(i),i instanceof n&&i.forEach(function(n){return l(t,e,n,r,o,a)}),a},c=function(t,e,n){var i;return"(root)"===t?[e]:"(self)"===t?[n]:(i=function(){switch(t.charAt(0)){case"#":return r;case".":return o;case"(":return a;default:return s}}(),l(i,t,e,n,e,[]))},{select:c,match:i}})}.call(this),function(){var t={}.hasOwnProperty;e("build/EventPump",["dou","./ComponentSelector"],function(e,n){"use strict";var i,r,o;return r=function(e,i,r,o,a){var s,c,l,u,h;h=[];for(u in r)t.call(r,u)&&(s=r[u],n.match(u,o.origin,i,e)&&h.push(function(){var e;e=[];for(c in s)t.call(s,c)&&(l=s[c],c===o.name&&(o.listener=i,e.push(l.apply(this,a))));return e}.call(this)));return h},o=function(){var t,e,n,i,o,a,s,c;for(t=arguments,e=t[t.length-1],n=this.eventPump,s=n.listeners,c=[],o=0,a=s.length;a>o;o++)i=s[o],c.push(r.call(this.context,n.deliverer,i.listener,i.clonedHandlers,e,t));return c},i=function(){function t(t){this.setDeliverer(t),this.listeners=[]}return t.prototype.setDeliverer=function(t){return this.deliverer=t},t.prototype.start=function(t){return this.deliverer.on("all",o,{context:t||null,eventPump:this})},t.prototype.stop=function(){return this.deliverer.off("all",o)},t.prototype.on=function(t,n){var i,r,o,a,s,c,l,u;for(i=e.util.clone(n),a=Object.keys(i),l=0,u=a.length;u>l;l++)o=a[l],0===o.indexOf("?")&&(r=i[o],c=o.substr(1),s=t.get(c),delete i[o],s?i[s]=r:console.log("EventPump#on","variable "+o+" is not evaluated on listener"));return this.listeners.push({listener:t,handlers:n,clonedHandlers:i})},t.prototype.off=function(t,e){var n,i,r,o,a,s;for(a=this.listeners,s=[],n=r=0,o=a.length;o>r;n=++r)i=a[n],i.listener!==t||e&&i.handlers!==e?s.push(void 0):s.push(this.listeners.splice(n,1));return s},t.prototype.clear=function(){return this.listeners=[]},t.prototype.dispose=function(){return this.stop(),this.clear()},t}()})}.call(this),function(){var t={}.hasOwnProperty;e("build/EventEngine",["dou","./EventPump","./ComponentSelector"],function(e,n,i){"use strict";var r;return r=function(){function r(t){this.eventMaps=[],this.setRoot(t)}return r.prototype.setRoot=function(t){return this.root=t},r.prototype.stop=function(){var t,e,n,i,r;for(i=this.eventMaps,r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(t.eventPump.stop());return r},r.prototype.add=function(e,r,o){var a,s,c,l,u,h;if(this.root){h=[];for(c in r)t.call(r,c)&&(s=r[c],u=i.select(c,this.root,e),h.push(function(){var t,i,c;for(c=[],t=0,i=u.length;i>t;t++)l=u[t],a=new n(l),a.on(e,s),a.start(o),c.push(this.eventMaps.push({eventPump:a,listener:e,handlerMap:r,target:l}));return c}.call(this)));return h}},r.prototype.remove=function(t,n){var i,r,o,a,s,c;for(o=e.util.clone(this.eventMaps),c=[],i=a=0,s=o.length;s>a;i=++a)r=o[i],r.listener!==t||n&&r.handlerMap!==n?c.push(void 0):(this.eventMaps.splice(i,1),c.push(r.eventPump.dispose()));return c},r.prototype.clear=function(){var t,n,i,r;for(n=e.util.clone(this.eventMaps),i=0,r=n.length;r>i;i++)t=n[i],t.eventPump.dispose();return this.eventMaps=[]},r.prototype.dispose=function(){return this.stop(),this.clear()},r}()})}.call(this),function(){var t={}.hasOwnProperty;e("build/EventTracker",["dou"],function(){"use strict";var e,n;return n=function(){function e(e,n,i){var r,o;this.started=!1,e&&(this.target=e),this.handlers=n,i=i||this.target||this,this.boundhandler={};for(r in n)t.call(n,r)&&(o=n[r],"function"==typeof o&&(this.boundhandler[r]=o.bind(i)))}return e.prototype.dispose=function(){return this.off()},e.prototype.on=function(){var e,n,i;if(!this.started){i=this.boundhandler;for(e in i)t.call(i,e)&&(n=i[e],this.target.on(e,n));return this.started=!0}},e.prototype.off=function(){var e,n,i;i=this.boundhandler;for(e in i)t.call(i,e)&&(n=i[e],this.target.off(e,n));return this.started=!1},e}(),e=function(){function t(){this.trackers=[]}return t.prototype.setSelector=function(t){return this.selector=t},t.prototype.on=function(t,e,i,r){var o,a,s,c,l,u;for(a=function(){switch(typeof t){case"object":return[t];case"string":return this.selector.select(t,i);default:return[]}}.call(this),a instanceof Array||(a=[a]),u=[],c=0,l=a.length;l>c;c++)o=a[c],s=new n(o,e,{listener:i,deliverer:o,context:r||o}),this.trackers.push(s),u.push(s.on());return u},t.prototype.off=function(t,e){var n,i,r,o,a,s,c,l;for(r=function(){var i,r,a,s;for(a=this.trackers,s=[],n=i=0,r=a.length;r>i;n=++i)o=a[n],t!==o.target||e&&e!==o.handlers||s.push(n);return s}.call(this),c=r.reverse(),l=[],a=0,s=c.length;s>a;a++)i=c[a],l.push(this.trackers.splice(i,1)[0].off());return l},t.prototype.all=function(){var t,e,n,i,r;for(i=this.trackers,r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(t);return r},t.prototype.dispose=function(){var t,e,n,i;for(i=this.trackers,e=0,n=i.length;n>e;e++)t=i[e],t.dispose();return this.trackers=[],this.selector=null},t.StandAlone=n,t}()})}.call(this),function(){var t={}.hasOwnProperty;e("build/ComponentFactory",["dou","./MVCMixin","./Component","./Container","./EventEngine","./EventTracker"],function(e,n,i,r){"use strict";var o;return o=function(){function n(t,e,n){this.componentRegistry=t,this.eventEngine=e,this.eventTracker=n}return n.prototype.seed=1,n.prototype.dispose=function(){return this.componentRegistry=null,this.eventEngine?this.eventEngine.dispose():void 0},n.prototype.uniqueId=function(){return"noid-"+this.seed++},n.prototype.createView=function(e,n){var i,o,a,s,c,l,u;if(s=e.type,a=this.componentRegistry.get(s),!a)throw new Error("Component Spec Not Found for type '"+s+"'");if(l=a.view_factory_fn.call(n,e.getAll()),n.attach(e,l),e instanceof r&&e.forEach(function(t){return l.add(this.createView(t,n))},this),a.view_event_map){u=a.view_event_map;for(o in u)t.call(u,o)&&(i=u[o],0!==o.indexOf("?")||(c=o.substr(1),o=e.get(c),void 0!==o)?this.eventTracker.on(o,i,l,n):console.log("ComponentFactory#crateView","variable "+o+" is not evaluated on listener"))}return l},n.prototype.createComponent=function(t,n){var o,a,s,c,l,u,h,p,d;if(s=this.componentRegistry.get(t.type),!s)throw new Error("Component Spec Not Found for type '"+t.type+"'");if(s.containable){if(a=new r(t.type),s.components)for(p=s.components,c=0,u=p.length;u>c;c++)o=p[c],a.add(this.createComponent(o,n));if(t.components)for(d=t.components,l=0,h=d.length;h>l;l++)o=d[l],a.add(this.createComponent(o,n))}else a=new i(t.type);return a.initialize(e.util.shallow_merge(s.defaults||{},t.attrs||{})),s.model_initialize_fn&&s.model_initialize_fn.call(a),a.get("id")||a.set("id",this.uniqueId()),s.exportable&&s.exportable(n,a),s.model_event_map&&this.eventEngine.add(a,s.model_event_map,n),a.addDisposer(function(t){return function(){var e,n,i,r;for(t.eventEngine.remove(a),r=a.getViews(),n=0,i=r.length;i>n;n++)e=r[n],t.eventTracker.off(e),e.destroy();return a.detachAll()}}(this)),a},n}()})}.call(this),function(){e("build/Command",["dou"],function(t){"use strict";var e;return e=function(){function e(e){this.params=t.util.clone(e)}return e.prototype.execute=function(){},e.prototype.unexecute=function(){},e}()})}.call(this),function(){e("build/CommandManager",["./Command"],function(t){"use strict";var e;return e=function(){function e(){this.reset()}return e.prototype.dispose=function(){return this.reset()},e.prototype.execute=function(e){return!e instanceof t?void 0:(e.execute(),this.exq.push(e),this.uxq=[])},e.prototype.undo=function(){var t;return t=this.exq.pop(),t?(t.unexecute(),this.uxq.push(t)):void 0},e.prototype.redo=function(){var t;return t=this.uxq.pop(),t?(t.execute(),this.exq.push(t)):void 0},e.prototype.undoable=function(){return this.exq.length>0},e.prototype.redoable=function(){return this.uxq.length>0},e.prototype.reset=function(){return this.exq=[],this.uxq=[]},e}()})}.call(this),function(){var t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e("build/command/CommandPropertyChange",["dou","../Command"],function(t,e){"use strict";var i;return i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.execute=function(){var t,e,n,i,r;for(i=this.params.changes,r=[],e=0,n=i.length;n>e;e++)t=i[e],t.property?r.push(t.component.set(t.property,t.after)):r.push(t.component.set(t.after));return r},e.prototype.unexecute=function(){var t,e,n,i,r;for(i=this.params.changes,r=[],e=0,n=i.length;n>e;e++)t=i[e],t.property?r.push(t.component.set(t.property,t.before)):r.push(t.component.set(t.before));return r},e}(e)})}.call(this),function(){var t={}.hasOwnProperty;e("build/ComponentRegistry",["dou"],function(e){"use strict";var n;return n=function(){function n(){this.componentSpecs={}}return n.prototype.dispose=function(){var t,e,n,i,r;for(t=Object.keys(this.componentSpecs),r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(this.unregister(e));return r},n.prototype.setRegisterCallback=function(t,e){return this.callback_register="function"==typeof t?t.bind(e):void 0},n.prototype.setUnregisterCallback=function(t,e){return this.callback_unregister="function"==typeof t?t.bind(e):void 0},n.prototype.register=function(t){var e,n,i;if(!this.componentSpecs[t.type]){if(t.dependencies){i=t.dependencies;for(n in i)e=i[n],this.register(e)}return this.componentSpecs[t.type]=t,this.callback_register?this.callback_register(t):void 0}},n.prototype.unregister=function(t){var e;return(e=this.componentSpecs[t])?(delete this.componentSpecs[t],this.callback_unregister&&this.callback_unregister(e),e):void 0},n.prototype.forEach=function(e,n){var i,r,o,a;o=this.componentSpecs,a=[];for(i in o)t.call(o,i)&&(r=o[i],a.push(e.call(n,i,r)));return a},n.prototype.list=function(){return Object.keys(this.componentSpecs).map(function(t){return this.componentSpecs[t]},this)},n.prototype.get=function(t){var n;return n=this.componentSpecs[t],n?e.util.clone(this.componentSpecs[t]):null},n}()})}.call(this),function(){e("build/SelectionManager",["dou"],function(t){"use strict";var e;return e=function(){function e(t){this.onselectionchange=t.onselectionchange,this.context=t.context,this.selections=[],this.selectable_fn=t.selectable_fn}return e.prototype.dispose=function(){return this.reset()},e.prototype.focus=function(e){var n,i;return e?(n=this.selections.indexOf(e),n>-1?(i=t.util.clone(this.selections),this.selections.splice(n,1),this.selections.unshift(e),this.onselectionchange?this.onselectionchange.call(this.context,{added:[],removed:[],before:i,after:this.selections}):void 0):this.toggle(e)):this.selections[0]},e.prototype.get=function(){return t.util.clone(this.selections)},e.prototype.toggle=function(e){var n,i,r,o;if(e)return r=t.util.clone(this.selections),i=this.selections.indexOf(e),i>-1?o=this.selections.splice(i,1):(n=[e],this.selections.unshift(e)),this.onselectionchange?this.onselectionchange.call(this.context,{added:n||[],removed:o||[],before:r,after:this.selections}):void 0},e.prototype.select=function(e){var n,i,r,o;return r=t.util.clone(this.selections),e instanceof Array||(e=e?[e]:[]),this.selections=function(){var t,n,r;for(r=[],t=0,n=e.length;n>t;t++)i=e[t],(!this.selectable_fn||this.selectable_fn(i))&&r.push(i);return r}.call(this),n=function(){var t,e,n,o;for(n=this.selections,o=[],t=0,e=n.length;e>t;t++)i=n[t],-1===r.indexOf(i)&&o.push(i);return o}.call(this),o=function(){var t,e,n;for(n=[],t=0,e=r.length;e>t;t++)i=r[t],-1===this.selections.indexOf(i)&&n.push(i);return n}.call(this),this.onselectionchange&&(n.length>0||o.length>0)?this.onselectionchange.call(this.context,{added:n,removed:o,before:r,after:this.selections}):void 0},e.prototype.reset=function(){var t;return t=this.selections,this.selections=[],t.length>0&&this.onselectionchange?this.onselectionchange.call(this.context,{added:[],removed:t,before:t,after:this.selections}):void 0},e}()})}.call(this),e("build/Clipboard",["module","require","exports"],function(){!function(){}.call(this)}),function(){e("build/ComponentSpec",["dou"],function(){"use strict";var t;return t=function(){function t(t){this.urn=t.urn,this.name=t.name,this.description=t.description,this.defaults=t.defaults,this.view_factory=t.view_factory,this.handle_factory=t.handle_factory,this.toolbox_image=t.toolbox_image}return t}()})}.call(this),function(){e("build/spec/SpecInfographic",["dou","KineticJS"],function(t,e){"use strict";var n,i;return i=function(t){return new e.Group(t)},n=function(t){return new Kin.Group(t)},{type:"infographic",name:"infographic",containable:!0,container_type:"container",description:"Infographic Specification",defaults:{draggable:!1},view_factory_fn:i,handle_factory_fn:n,toolbox_image:"images/toolbox_infographic.png"}})}.call(this),function(){var t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e("build/command/CommandMove",["dou","../Command"],function(t,e){"use strict";var i;return i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.execute=function(){var t,e,n,i;switch(n=this.params.to,e=this.params.model,i=this.params.view,this.i_model=e.getContainer().indexOf(e),this.i_view=i.getZIndex(),n){case"FORWARD":i.moveUp(),e.moveForward();break;case"BACKWARD":i.moveDown(),e.moveBackward();break;case"FRONT":i.moveToTop(),e.moveToFront();break;case"BACK":i.moveToBottom(),e.moveToBack()}return t=i.getLayer(),t?t.draw():void 0},e.prototype.unexecute=function(){var t,e,n,i;return n=this.params.to,e=this.params.model,i=this.params.view,i.setZIndex(this.i_view),e.moveAt(this.i_model),t=i.getLayer(),t?t.draw():void 0},e}(e)})}.call(this),function(){e("build/spec/SpecContentEditLayerExportable",["../command/CommandPropertyChange","../command/CommandMove"],function(t,e){var n,i,r,o,a,s,c,l,u,h;return h=function(t,n){var i;return(i=t.selectionManager.focus())?t.execute(new e({to:n,view:i,model:t.getAttachedModel(i)})):void 0},a=function(t){return h(t,"FORWARD")},r=function(t){return h(t,"BACKWARD")},c=function(t){return h(t,"FRONT")},s=function(t){return h(t,"BACK")},i=function(t){return t.clipboard.cut(t.selectionManager.get())},n=function(t){return t.clipboard.copy(t.selectionManager.get())},u=function(t){var e,n,i;return n=t.clipboard.paste(),i=function(){var i,r,o;for(o=[],i=0,r=n.length;r>i;i++)e=n[i],o.push(t.getAttachedModel(e));return o}(),t.selectionManager.select(i)},o=function(e,n,i){var r,o,a,s,c,l,u,h,p;for(u=e.selectionManager.get(),s=[],h=0,p=u.length;p>h;h++){l=u[h],c=e.getAttachedModel(l),a={},r={};for(o in i)a[o]=c.get(o),r[o]=c.get(o)+i[o];s.push({component:c,before:a,after:r})}return e.commandManager.execute(new t({changes:s}))},l=function(t,e,n){var i;return i=e.getViews()[0],i.offset(n),i.fire("change-offset",i.offset(),!1),i.batchDraw()},function(t,e){var h,p,d,f;h={moveDelta:function(n){return o(t,e,n)},moveForward:function(){return a(t,e)},moveBackward:function(){return r(t,e)},moveToFront:function(){return c(t,e)},moveToBack:function(){return s(t,e)},offset:function(n){return l(t,e,n)},cut:function(){return i(t,e)},copy:function(){return n(t,e)},paste:function(){return u(t,e)}},f=[];for(d in h)p=h[d],f.push(t[d]=p);return f}})}.call(this),function(){e("build/spec/SpecContentEditLayer",["dou","KineticJS","../command/CommandPropertyChange","./SpecContentEditLayerExportable"],function(t,e,n,i){"use strict";var r,o,a,s,c,l,u,h,p,d,f,g,_,y,m,v,w;return m=function(t){var n,i,r,o;return o=this.getView().getStage(),r=t.offset||{x:0,y:0},i=new e.Layer(t),n=new e.Rect({name:"background for ruler-layer",draggable:!0,listening:!0,x:0,y:0,width:Math.min(o.width()+r.x,o.width()),height:Math.min(o.height()+r.y,o.height()),stroke:t.stroke,fill:"cyan",opacity:.1}),i.getBackground=function(){return n},i.getOriginOffset=function(){return r},i.add(n),i},o=function(){},a=function(){},g=function(){},c=function(t,e,n){var i;return i=n.listener,e&&(i.remove(e),e.dispose()),t?i.add(t):void 0},u=function(t){var e;return e=this,t.length>0?console.log("selection-changed",t[0],e.getAttachedModel(t[0])):void 0},s=function(t,e,n){var i;return i=t.getViews()[0],i.setAttrs(n),i.getLayer().batchDraw()},w=function(t){var e,n;return e=t.offset(),n=t.getOriginOffset(),t.getBackground().position({x:e.x-n.x,y:e.y-n.y})},v=function(t,e){var n;return n=t.getStage().scale(),{x:Math.round(e.offsetX/n.x),y:Math.round(e.offsetY/n.y)}},f=function(t){var n,i,r,o,a,s;return i=this.context,r=this.listener,o=i.getAttachedModel(r),n=r.getBackground(),a=t.targetNode,i.selectionManager.select(a),a&&a!==n?void 0:(this.layerOffsetOnStart=r.offset(),this.mousePointOnStart=v(r,t),s={x:this.mousePointOnStart.x+this.layerOffsetOnStart.x,y:this.mousePointOnStart.y+this.layerOffsetOnStart.y},this.selectbox=new e.Rect({stroke:"black",strokeWidth:1,dash:[3,3]}),r.add(this.selectbox),this.selectbox.setAttrs(s),w(r),r.draw(),t.cancelBubble=!0)},d=function(t){var e,n,i,r,o,a,s;return n=this.context,i=this.listener,r=n.getAttachedModel(i),e=i.getBackground(),s=t.targetNode,s&&s!==e?void 0:(o=v(i,t),a={x:o.x-this.mousePointOnStart.x,y:o.y-this.mousePointOnStart.y},this.selectbox.setAttrs({width:a.x,height:a.y}),w(i),i.batchDraw(),t.cancelBubble=!0)},p=function(t){var e,i,r,o,a,s,c;return r=this.context,s=this.listener,c=r.getAttachedModel(s),a=t.targetNode,o=r.getAttachedModel(a),o&&(i=new n({changes:[{component:o,before:{x:o.get("x"),y:o.get("y")},after:{x:a.x(),y:a.y()}}]}),r.execute(i)),s=this.listener,e=s.getBackground(),t.targetNode&&t.targetNode!==e?void 0:(this.selectbox.remove(),delete this.selectbox,w(s),s.draw(),t.cancelBubble=!0)},h=function(t){var e;return e=t.targetNode,this.context.selectionManager.select(e)},_=function(t){var e,n;return n=this.listener,e=n.getBackground(),e.setSize(t.after),n.batchDraw()},l=function(){var t;return t=this.listener,w(t)},r={"(root)":{"(root)":{"change-model":c,"change-selections":u}},"(self)":{"(self)":{added:a,removed:g},"(all)":{change:s}}},y={"(self)":{dragstart:f,dragmove:d,dragend:p,click:h,"change-offset":l},"(root)":{resize:_}},{type:"content-edit-layer",name:"content-edit-layer",containable:!0,container_type:"layer",description:"Selection Edit Layer Specification",defaults:{listening:!0,draggable:!1},model_event_map:r,view_event_map:y,model_initialize_fn:o,view_factory_fn:m,toolbox_image:"images/toolbox_content_edit_layer.png",exportable:i}})}.call(this),function(){e("build/spec/SpecGuideLayer",["KineticJS"],function(t){"use strict";var e,n,i,r,o,a,s,c,l,u;return l=function(e){return new t.Layer(e)},i=function(e,n,i,r){var o,a,s,c,l;return o=this,a=r.listener,l=o.getAttachedViews(a)[0],c=a._track=a._track||{},c.changes=(c.changes||0)+1,c.text||(c.text=new t.Text({x:10,y:10,listening:!1,fontSize:12,fontFamily:"Calibri",fill:"green"}),l.add(c.text)),s="[ PropertyChange ] "+e.type+" : "+e.get("id")+"\n[ Before ] "+JSON.stringify(n)+"\n[ After ] "+JSON.stringify(i),c.text.setAttr("text",s),l.draw(),setTimeout(function(){var e;if(!(--c.changes>0))return e=new Kinetic.Tween({node:c.text,opacity:0,duration:1,easing:t.Easings.EaseOut}),e.play(),setTimeout(function(){return c.changes>0?(e.reset(),e.destroy(),void 0):(e.finish(),e.destroy(),c.text.remove(),delete c.text,l.draw())},1e3)},5e3)},u=function(t,e){var n,i,r,o;return n=t.offset(),r=e.getLayer().offset(),i=e.getAbsolutePosition(),o=e.getStage().scale(),{x:i.x/o.x+n.x,y:i.y/o.y+n.y}},a=function(e){var n,i,r,o;return i=this.listener,r=e.targetNode,o=i.getStage(),this.scale=o.getScale(),this.width=o.getWidth(),this.height=o.getHeight(),n=u(i,r),this.vert=new t.Line({stroke:"red",tension:1,points:[n.x,0,n.x,this.height]}),this.hori=new t.Line({stroke:"red",tension:1,points:[0,n.y,this.width,n.y]}),this.text=new t.Text({listening:!1,fontSize:12,fontFamily:"Calibri",fill:"green"}),this.text.setAttrs({text:"[ "+n.x+"("+r.x()+"), "+n.y+"("+r.y()+") ]",x:Math.max(n.x,0)>this.text.width()+10?n.x-(this.text.width()+10):Math.max(n.x+10,10),y:Math.max(n.y,0)>this.text.height()+10?n.y-(this.text.height()+10):Math.max(n.y+10,10)}),i.add(this.vert),i.add(this.hori),i.add(this.text),i.batchDraw()},o=function(t){var e,n,i,r,o,a,s,c,l,h,p,d,f,g;return o=this.context,s=this.listener,c=t.targetNode,h=c.position(),c.position({x:10*Math.round(h.x/10),y:10*Math.round(h.y/10)}),a=u(s,c),this.vert.setAttrs({points:[a.x,0,a.x,this.height]}),this.hori.setAttrs({points:[0,a.y,this.width,a.y]}),this.text.setAttrs({text:"[ "+a.x+"("+c.x()+"), "+a.y+"("+c.y()+") ]",x:Math.max(a.x,0)>this.text.width()+10?a.x-(this.text.width()+10):Math.max(a.x+10,10),y:Math.max(a.y,0)>this.text.height()+10?a.y-(this.text.height()+10):Math.max(a.y+10,10)}),d=c.getStage().scale(),n=1*((c.getStage().width()+s.offset().x)/d.x)/5,i=4*((c.getStage().width()+s.offset().x)/d.x)/5,r=1*((c.getStage().height()+s.offset().y)/d.y)/5,e=4*((c.getStage().height()+s.offset().y)/d.y)/5,console.log(n,i,r,e),(a.x<n||a.x>i||a.y<r||a.y>e)&&(l=c.getLayer(),p=l.offset(),f=a.x<=n?Math.max(p.x-10,-20):a.x>=i?p.x+10:p.x,g=a.y<=r?Math.max(p.y-10,-20):a.y>=e?p.y+10:p.y,console.log(a,f,g),(p.x!==f||p.y!==g)&&o.offset({x:f,y:g})),s.batchDraw()},r=function(){var t;return t=this.listener,this.vert.remove(),this.hori.remove(),this.text.remove(),t.batchDraw()},n=function(){},s=function(){},e={"(root)":{"(all)":{change:i}},"(self)":{"(self)":{added:n,removed:s}}},c={"(root)":{dragstart:a,dragmove:o,dragend:r}},{type:"guide-layer",name:"guide-layer",containable:!0,container_type:"layer",description:"Editing Guide Specification",defaults:{draggable:!1},model_event_map:e,view_event_map:c,view_factory_fn:l,toolbox_image:"images/toolbox_guide_layer.png"}})}.call(this),function(){e("build/spec/SpecRulerLayer",["dou","KineticJS"],function(t,e){"use strict";var n,i,r,o,a,s;return n=function(t){return new e.Layer(t)},o=function(t){var e,n;return n=this.listener,n.__hori__||(e=n.getChildren().toArray(),n.__hori__=e[0],n.__vert__=e[1]),n.__hori__.setAttr("zeropos",-t.x),n.__vert__.setAttr("zeropos",-t.y),n.batchDraw()},a=function(t){var e,n;return n=this.listener,n.__hori__||(e=n.getChildren().toArray(),n.__hori__=e[0],n.__vert__=e[1]),n.__hori__.setSize({width:t.after.width,height:20}),n.__vert__.setSize({width:20,height:t.after.height}),n.batchDraw()},r=function(t,e,n,i){var r,o,a,s,c;return o=this,a=i.listener,c=o.getAttachedViews(a)[0],s=c.getStage(),c.__hori__||(r=c.getChildren().toArray(),c.__hori__=r[0],c.__vert__=r[1]),c.__hori__.setSize({width:s.width(),height:20}),c.__vert__.setSize({width:20,height:s.height()}),c.batchDraw()},i={"(root)":{"(self)":{added:r}}},s={"?offset_monitor_target":{"change-offset":o},"(root)":{resize:a}},{type:"ruler-layer",name:"ruler-layer",containable:!0,container_type:"layer",description:"Ruler Layer Specification",defaults:{draggable:!1},model_event_map:i,view_event_map:s,view_factory_fn:n,components:[{type:"ruler",attrs:{direction:"horizontal",name:"horizontal ruler for ruler-layer",margin:[20,0],opacity:.8,x:0,y:0,width:1e3,height:20,zeropos:20}},{type:"ruler",attrs:{direction:"vertical",name:"vertical ruler for ruler-layer",margin:[20,0],opacity:.8,x:0,y:0,width:20,height:1e3,zeropos:20}}],toolbox_image:"images/toolbox_ruler_layer.png"}})}.call(this),function(){e("build/spec/SpecHandleLayer",["dou","KineticJS"],function(t,e){"use strict";var n,i,r,o,a,s,c;return n=function(t){var n;return n=new e.Layer(t),n.handles={},n},r=function(t){var e;return e=this.listener,e.offset({x:t.x,y:t.y}),e.batchDraw()},s=function(t){var e,n,i;return i=this.listener,n=t.targetNode.getAttr("id"),e=i.handles[n],e?(e.setAbsolutePosition(t.targetNode.getAbsolutePosition()),i.batchDraw()):void 0},a=function(t){var e,n,i;return i=this.listener,n=t.targetNode.getAttr("id"),e=i.handles[n],e?(e.setAbsolutePosition(t.targetNode.getAbsolutePosition()),i.draw()):void 0},o=function(t,e,n,i,r){var o,a,s,c,l,u,h,p,d,f,g,_,y;for(o=this,u=r.listener,d=o.getAttachedViews(u)[0],f=0,_=i.length;_>f;f++)h=i[f],l=h.getAttr("id"),a=d.handles[l],s=o.getAttachedModel(a),u.remove(s),delete d.handles[l];for(g=0,y=n.length;y>g;g++)h=n[g],l=h.getAttr("id"),p=h.getAbsolutePosition(),s=this.createComponent({type:"handle-rect",attrs:{}}),u.add(s),c=o.getAttachedViews(s)[0],c.setTarget(h),d.handles[l]=c;return d.batchDraw()},i={"(root)":{"(root)":{"change-selections":o}}},c={"?offset_monitor_target":{"change-offset":r,dragmove:s,dragend:a}},{type:"handle-layer",name:"handle-layer",containable:!0,container_type:"layer",description:"Handle Layer Specification",defaults:{draggable:!1},model_event_map:i,view_event_map:c,view_factory_fn:n,toolbox_image:"images/toolbox_handle_layer.png"}})}.call(this),function(){e("build/spec/SpecMinimapLayer",["KineticJS"],function(t){"use strict";var e,n,i,r,o,a,s,c,l,u;return c=function(e){var n,i,r,o,a,s,c,l;return s=this.getView().getStage(),o=new t.Layer(e),i=this,c=null,a=s.scale(),l={x:0,y:0},n=new t.Rect({name:"background for minimap-layer",draggable:!0,listening:!0,x:0,y:0,width:s.width(),height:s.height(),stroke:e.stroke,fill:"white",opacity:0,dragBoundFunc:function(){return l}}),r=new t.Circle({name:"handle for minimap-layer",draggable:!0,listening:!0,x:s.width()/a.x/2,y:s.height()/a.y/2,radius:50,stroke:"red",fill:"red",opacity:.5}),o.getTargetLayer=function(){var t;return c?c:(t=i.findComponent(e.target_layer)[0])?(c=i.getAttachedViews(t)[0],c&&t.addDisposer(function(){return c=null
}),c):null},o.getBackground=function(){return n},o.getHandle=function(){return r},o.add(n),o.add(r),o},l=function(t,e){var n;return n=t.getStage().scale(),{x:Math.round(e.offsetX/n.x),y:Math.round(e.offsetY/n.y)}},u=function(t){var e,n,i;return i=t.getStage(),n=i.scale(),e=t.getHandle(),e.position({x:i.width()/n.x/2,y:i.height()/n.y/2})},a=function(t){var e,n,i,r;return n=this.listener,r=n.getStage(),i=r.scale(),e=n.getBackground(),e.setSize(t.after),u(n),n.batchDraw()},o=function(t){var e,n,i,r,o;return e=this.context,t.cancelBubble=!0,r=this.listener,(o=r.getTargetLayer())?(n=r.getHandle(),t.targetNode===n?(i=n.position(),this.interval=setInterval(function(){return function(){var t,r,a;return t=n.position(),r={x:t.x-i.x,y:t.y-i.y},a=o.offset(),e.offset({x:a.x+r.x/5,y:a.y+r.y/5})}}(this),100)):(this.targetLayerOffsetOnStart=o.offset(),this.mousePointOnStart=l(r,t))):void 0},r=function(t){var e,n,i,r,o;return t.cancelBubble=!0,e=this.context,n=this.listener,o=n.getTargetLayer(),o&&t.targetNode!==n.getHandle()?(i=l(n,t),r={x:i.x-this.mousePointOnStart.x,y:i.y-this.mousePointOnStart.y},e.offset({x:this.targetLayerOffsetOnStart.x-r.x,y:this.targetLayerOffsetOnStart.y-r.y}),n.batchDraw()):void 0},i=function(t){var e;return t.cancelBubble=!0,this.interval&&(clearInterval(this.interval),this.interval=null),e=this.listener,e.offset({x:0,y:0}),u(e),e.batchDraw()},n=function(t,e,n){var i;return i=t.getViews()[0],i.setAttrs(n),i.getLayer().batchDraw()},e={"(self)":{"(self)":{change:n}}},s={"(self)":{dragstart:o,dragmove:r,dragend:i},"(root)":{resize:a}},{type:"minimap-layer",name:"minimap-layer",containable:!0,container_type:"layer",description:"Minimap Layer Specification",defaults:{visible:!1,listening:!0},model_event_map:e,view_event_map:s,view_factory_fn:c,toolbox_image:"images/toolbox_minimap_layer.png",exportable:function(t,e){return t.showMinimap=function(){return e.set("visible",!0)},t.hideMinimap=function(){return e.set("visible",!1)}}}})}.call(this),function(){e("build/spec/SpecGroup",["dou","KineticJS"],function(t,e){"use strict";var n,i,r;return r=function(t){return t.targetNode&&t.targetNode!==this.__background__?void 0:t.targetNode=this},i=function(n){var i,o;return o=new e.Group(n),i=new e.Rect(t.util.shallow_merge({},n,{draggable:!1,listening:!0,x:0,y:0,id:void 0})),o.add(i),n.draggable&&(o.on("dragstart dragmove dragend",r),o.__background__=i),o},n=function(t){return new Kin.Group(t)},{type:"group",name:"group",containable:!0,container_type:"container",description:"Group Specification",defaults:{width:100,height:50,stroke:"black",strokeWidth:4,draggable:!0,listening:!0,opacity:1},view_factory_fn:i,handle_factory_fn:n,toolbox_image:"images/toolbox_group.png"}})}.call(this),function(){e("build/spec/SpecRect",["KineticJS"],function(t){"use strict";var e,n;return n=function(e){return new t.Rect(e)},e=function(t){return new Kin.Rect(t)},{type:"rectangle",name:"rectangle",description:"Rectangle Specification",defaults:{width:100,height:50,fill:"green",stroke:"black",strokeWidth:4},view_factory_fn:n,handle_factory_fn:e,toolbox_image:"images/toolbox_rectangle.png"}})}.call(this),function(){e("build/spec/SpecCircle",["KineticJS"],function(t){"use strict";var e,n;return n=function(e){return new t.Circle(e)},e=function(t){return new Kin.Circle(t)},{type:"circle",name:"circle",description:"Circle Specification",defaults:{width:100,height:100,fill:"green",stroke:"black",strokeWidth:4},view_factory_fn:n,handle_factory_fn:e,toolbox_image:"images/toolbox_circle.png"}})}.call(this),function(){e("build/spec/SpecRing",["KineticJS"],function(t){"use strict";var e,n;return n=function(e){return new t.Ring(e)},e=function(t){return new Kin.Ring(t)},{type:"ring",name:"ring",description:"Ring Specification",defaults:{innerRadius:40,outerRadius:80,fill:"red",stroke:"black",strokeWidth:5},view_factory_fn:n,handle_factory_fn:e,toolbox_image:"images/toolbox_ring.png"}})}.call(this),function(){e("build/spec/SpecRuler",["KineticJS"],function(){"use strict";var t,e,n,i,r,o;return t=3.779527559,r=function(e){var n,i,r,o,a,s,c,l,u,h,p,d,f,g,_,y,m,v,w,x;for(h=parseInt(this.getAttr("zeropos")),o=this.getAttr("margin")[0],a=this.width()-this.getAttr("margin")[1],n=this.height()-15,i=this.height(),e.beginPath(),e.moveTo(0,0),e.lineTo(0,this.height()),e.lineTo(this.width(),this.height()),e.lineTo(this.width(),0),e.lineTo(0,0),u=this.width()-h,l=Math.ceil(u/t),r=d=0,y=l-1;(y>=0?y>=d:d>=y)&&(p=h+r*t,!(p>a));r=y>=0?++d:--d)o>p||(0===r%10?(e.moveTo(p,n),e.lineTo(p,i)):0===r%5?(e.moveTo(p,n+8),e.lineTo(p,i)):(e.moveTo(p,n+11),e.lineTo(p,i)));for(c=h,s=Math.floor(c/t),r=f=1,m=s-1;(m>=1?m>=f:f>=m)&&(p=h-r*t,!(o>p));r=m>=1?++f:--f)p>a||(0===r%10?(e.moveTo(p,n),e.lineTo(p,i)):0===r%5?(e.moveTo(p,n+8),e.lineTo(p,i)):(e.moveTo(p,n+11),e.lineTo(p,i)));for(e.closePath(),e.fillStrokeShape(this),r=g=0,v=l-1;v>=g&&(p=h+r*t,!(p>a));r=g+=10)o>p||e.strokeText(""+r/10,p+2,n+10);for(x=[],r=_=10,w=s-1;w>=_&&(p=h-r*t,!(o>p));r=_+=10)p>a||x.push(e.strokeText("-"+r/10,p+2,n+10));return x},o=function(e){var n,i,r,o,a,s,c,l,u,h,p,d,f,g,_,y,m,v,w,x;for(h=parseInt(this.getAttr("zeropos")),a=this.getAttr("margin")[0],o=this.height()-this.getAttr("margin")[1],n=this.width()-15,i=this.width(),e.beginPath(),e.moveTo(0,0),e.lineTo(0,this.height()),e.lineTo(this.width(),this.height()),e.lineTo(this.width(),0),e.lineTo(0,0),l=this.height()-h,u=Math.ceil(l/t),r=d=0,y=u-1;(y>=0?y>=d:d>=y)&&(p=h+r*t,!(p>o));r=y>=0?++d:--d)a>p||(0===r%10?(e.moveTo(n,p),e.lineTo(i,p)):0===r%5?(e.moveTo(n+8,p),e.lineTo(i,p)):(e.moveTo(n+11,p),e.lineTo(i,p)));for(s=h,c=Math.floor(s/t),r=f=1,m=c-1;m>=1?m>=f:f>=m;r=m>=1?++f:--f)if(p=h-r*t,!(p>o)){if(a>p)break;0===r%10?(e.moveTo(n,p),e.lineTo(i,p)):0===r%5?(e.moveTo(n+8,p),e.lineTo(i,p)):(e.moveTo(n+11,p),e.lineTo(i,p))}for(e.closePath(),e.fillStrokeShape(this),r=g=0,v=u-1;v>=g&&(p=h+r*t,!(p>o));r=g+=10)a>p||e.strokeText(""+r/10,1,p+10);for(x=[],r=_=10,w=c-1;w>=_&&(p=h-r*t,!(a>p));r=_+=10)p>o||x.push(e.strokeText("-"+r/10,1,p+10));return x},i=function(){return"vertical"!==this.getAttr("direction")?r.apply(this,arguments):o.apply(this,arguments)},n=function(t){return new Kinetic.Shape(t)},e=function(t){return new Kin.Rect(t)},{type:"ruler",name:"ruler",description:"Ruler Specification",defaults:{drawFunc:i,fill:"#848586",stroke:"#C2C3C5",strokeWidth:.5,width:100,height:50,margin:[15,15],zeropos:15,direction:"horizontal",font:"8px Verdana"},view_factory_fn:n,handle_factory_fn:e,toolbox_image:"images/toolbox_ruler.png"}})}.call(this),function(){e("build/spec/SpecImage",["KineticJS"],function(t){"use strict";var e,n,i,r;return n=function(e){var n,i;return n=new t.Image(e),i=new Image,i.onload=function(){var t;return t=n.getLayer(),t?t.draw():void 0},i.src=e.url,n.setImage(i),n},e=function(t){return new Kin.Image(t)},i={"(self)":{"(self)":{change:function(t,e,n){var i,r,o;if(e.url||n.url)return i=this,o=i.getAttachedViews(t)[0],r=o.getImage(),r.src=n.url}}}},r={"(self)":{click:function(){var t,e,n;return t=this.context,n=this.listener,e=t.getAttachedModel(n),this.count=this.count?++this.count:1,this.count%2?e.set("url","http://www.baidu.com/img/bdlogo.gif"):e.set("url","http://i.cdn.turner.com/cnn/.e/img/3.0/global/header/intl/CNNi_Logo.png")}}},{type:"image",name:"image",description:"Image Specification",defaults:{width:100,height:50,stroke:"black",strokeWidth:1,rotationDeg:0,draggable:!0},model_event_map:i,view_event_map:r,view_factory_fn:n,handle_factory_fn:e,toolbox_image:"images/toolbox_image.png"}})}.call(this),function(){e("build/spec/SpecText",["KineticJS"],function(t){"use strict";var e,n;return n=function(e){return new t.Text(e)},e=function(t){return new Kin.Text(t)},{type:"text",name:"text",description:"Text Specification",defaults:{width:"auto",height:"auto",draggable:!0,strokeWidth:1,fontSize:40,fontFamily:"Arial",fontStyle:"normal",fill:"black",stroke:"black",text:"TEXT",rotationDeg:0},view_factory_fn:n,handle_factory_fn:e,toolbox_image:"images/toolbox_text.png"}})}.call(this),function(){e("build/spec/SpecStar",["KineticJS"],function(t){"use strict";var e,n;return n=function(e){return new t.Star(e)},e=function(t){return new Kin.Star(t)},{type:"star",name:"star",description:"Star Specification",defaults:{width:100,height:50,numPoints:5,innerRadius:35,outerRadius:70,fill:"red",stroke:"black",strokeWidth:4},view_factory_fn:n,handle_factory_fn:e,toolbox_image:"images/toolbox_star.png"}})}.call(this),function(){e("build/spec/SpecBarcode",["bwip","KineticJS"],function(t,e){"use strict";var n,i,r;return i=function(n){var i,r;return r=new e.Image({x:n.x,y:n.y,draggable:!0,id:n.id}),i=new Image,i.onload=function(){var t;return r.setAttrs({width:i.width,height:i.height}),t=r.getLayer(),t?t.draw():void 0},i.src=t.imageUrl({symbol:n.symbol,text:n.text,alttext:n.alttext,scale_h:n.scale_h,scale_w:n.scale_w,rotation:n.rotation}),r.setImage(i),r},n=function(t){return new Kin.Image(t)},r={"(self)":{"(self)":{change:function(e,n,i){var r,o,a,s;if(!i.x&&!i.y)return r=this,s=r.getAttachedViews()[0],a=t.imageUrl({symbol:e.get("symbol"),text:e.get("text"),alttext:e.get("alttext"),scale_h:e.get("scale_h"),scale_w:e.get("scale_w"),rotation:e.get("rotation")}),o=s.getImage(),o.src=a}}}},{type:"barcode",name:"barcode",description:"Barcode Specification",defaults:{width:100,height:50,stroke:"black",strokeWidth:1,rotationDeg:0,draggable:!0},model_event_map:r,view_factory_fn:i,handle_factory_fn:n,toolbox_image:"images/toolbox_barcode.png"}})}.call(this),function(){e("build/handle/HandleChecker",["dou","KineticJS"],function(t,e){"use strict";var n,i;return i=function(n){var i,r;return r=["red","black","yellow","cyan"],i=Math.floor(10*Math.random())%r.length,new e.Rect(t.util.shallow_merge(n,{fill:r[i]}))},n=function(t){return new Kin.Rect(t)},{type:"handle-checker",name:"handle-checker",description:"Checker Handle Specification",defaults:{width:10,height:10,fill:"red",stroke:"black",strokeWidth:2},view_factory_fn:i,handle_factory_fn:n,toolbox_image:"images/toolbox_handle_checker.png"}})}.call(this),function(){var t={}.hasOwnProperty,n=function(e,n){function i(){this.constructor=e}for(var r in n)t.call(n,r)&&(e[r]=n[r]);return i.prototype=n.prototype,e.prototype=new i,e.__super__=n.prototype,e};e("build/handle/HandleRect",["dou","KineticJS"],function(t,e){"use strict";var i,r,o,a,s,c,l,u,h,p;return a=-1,r=0,c=1,h=-1,s=0,i=1,o=function(t){function i(t,n,i,r,o,a){this._align=[t,n],e.Circle.call(this,{radius:i,fill:r,stroke:o,strokeWidth:a,draggable:!0})}return n(i,t),i.prototype.getAlign=function(){return this._align},i}(e.Circle),u=function(t){function i(t,n,i,r){e.Circle.call(this,{radius:t,fill:n,stroke:i,strokeWidth:r,draggable:!0})}return n(i,t),i}(e.Circle),l=function(t){function l(t){this._options=t,this._handlers=[],this._rotateHandler=null,this._border=null,e.Group.call(this,{width:t.width,height:t.height,fill:t.fill,stroke:t.stroke,strokeWidth:t.strokeWidth,draggable:!0}),this.createBorder(),this.addHandler(h,a),this.addHandler(h,r),this.addHandler(h,c),this.addHandler(s,a),this.addHandler(s,c),this.addHandler(i,a),this.addHandler(i,r),this.addHandler(i,c),this.addRotateHandler()}return n(l,t),l.prototype.createBorder=function(){return this._border=new e.Line({points:[0,0],stroke:this._options["border-stroke"],strokeWidth:this._options["border-stroke-width"]}),this.add(this._border)},l.prototype.addRotateHandler=function(){var t;return t=this,this._rotateHandler=new u({radius:this._options["handler-radius"],fill:this._options["handler-fill"],stroke:this._options["handler-stroke"],strokeWidth:this._options["handler-stroke-width"]}),this._rotateHandler.setDragBoundFunc(function(e){var n,i,r;return this.isDragging()&&(i=rotateGroup.getAbsolutePosition(),r={x:i.x-e.x,y:i.y-e.y},n=t.getAngle(r),rotateGroup.setRotation(n)),e}),this._rotateHandler.on("dragmove",function(){return t.update()}),this.add(this._rotateHandler),this._rotateHandler},l.prototype.addHandler=function(t,e){var n;return n=new o(t,e,this._options["handler-radius"],this._options["handler-fill"],this._options["handler-stroke"],this._options["handler-strokeWidth"]),this.add(n),this._handlers.push(n)},l.prototype.getHandlerByAlign=function(t,e){var n,i,r,o,a;for(a=this._handlers,r=0,o=a.length;o>r;r++)if(i=a[r],n=i.getAlign(),n[0]===t&&n[1]===e)return i;return null},l.prototype.getOppositeHandler=function(t){var e;return e=t.getAlign(),this.getHandlerByAlign(-e[0],-e[1])},l.prototype.setTarget=function(t){return this._target=t,this.update()},l.prototype.showHandle=function(){return this.visible(!0)},l.prototype.hideHandle=function(){return this.visible(!1)},l.prototype.update=function(){var t,e,n,o,l,u,p,d,f,g,_,y,m,v;return m=this._target.getX()-this._target.getOffsetX(),v=this._target.getY()-this._target.getOffsetY(),y=this._target.getWidth(),_=this._target.getHeight(),g={x:m+y/2,y:v-this._options["rotate-distance"]},l={x:m,y:v},f={x:m+y,y:v},n={x:m,y:v+_},p={x:m+y,y:v+_},e={x:m+y/2,y:v},o={x:m,y:v+_/2},d={x:m+y,y:v+_/2},t={x:m+y/2,y:v+_},u=[e,l,n,p,f,e],this._options["allow-rotate"]&&u.unshift(g),this._border.setPoints(u),this._rotateHandler.setPosition(g),this.getHandlerByAlign(a,h).setPosition(l),this.getHandlerByAlign(c,h).setPosition(f),this.getHandlerByAlign(a,i).setPosition(n),this.getHandlerByAlign(c,i).setPosition(p),this.getHandlerByAlign(r,h).setPosition(e),this.getHandlerByAlign(a,s).setPosition(o),this.getHandlerByAlign(c,s).setPosition(d),this.getHandlerByAlign(r,i).setPosition(t)},l}(e.Group),p=function(t){var e;return e=new l(t)},{type:"handle-rect",name:"handle-rect",description:"Rectangle Handle Specification",defaults:{width:10,height:10,fill:"red",stroke:"black",strokeWidth:2,"handler-radius":10,"handler-fill":"gray","handler-stroke":"black","handler-strokeWidth":2,"rotate-distance":10,"border-stroke":"black","border-stroke-width":2},view_factory_fn:p,toolbox_image:"images/toolbox_handle_rect.png"}})}.call(this),function(){e("build/spec/SpecPainter",["KineticJS","./SpecInfographic","./SpecContentEditLayer","./SpecGuideLayer","./SpecRulerLayer","./SpecHandleLayer","./SpecMinimapLayer","./SpecGroup","./SpecRect","./SpecCircle","./SpecRing","./SpecRuler","./SpecImage","./SpecText","./SpecStar","./SpecBarcode","../handle/HandleChecker","../handle/HandleRect"],function(t,e,n,i,r,o,a,s,c,l,u,h,p,d,f,g,_,y){"use strict";var m;return m=function(e){return new t.Stage(e)},{type:"painter-app",name:"painter-app",containable:!0,container_type:"application",description:"Painter Application Specification",defaults:{},view_factory_fn:m,dependencies:{infographic:e,"content-edit-layer":n,"guide-layer":i,"ruler-layer":r,"handle-layer":o,"minimap-layer":a,group:s,rect:c,circle:l,ring:u,ruler:h,image:p,text:d,star:f,barcode:g,"handle-checker":_,"handle-rect":y},layers:[{type:"content-edit-layer",attrs:{offset:{x:-20,y:-20}}},{type:"handle-layer",attrs:{offset_monitor_target:"content-edit-layer",offset:{x:-20,y:-20}}},{type:"guide-layer",attrs:{target_layer:"content-edit-layer",offset:{x:-20,y:-20}}},{type:"ruler-layer",attrs:{offset_monitor_target:"content-edit-layer"}},{type:"minimap-layer",attrs:{target_layer:"content-edit-layer"}}],toolbox_image:"images/toolbox_painter_app.png"}})}.call(this),function(){e("build/spec/SpecContentViewLayer",["dou","KineticJS"],function(t,e){"use strict";var n,i,r,o,a,s,c,l,u;return l=function(t){return new e.Layer(t)},i=function(){},r=function(){},s=function(){},a=function(t,e,n){var i;return i=n.listener,e&&(i.remove(e),e.dispose()),t?i.add(t):void 0},o=function(t,e,n){var i;return i=t.getViews()[0],i.setAttrs(n),i.getLayer().batchDraw()},u=function(t,e){var n;return n=t.getStage().scale(),{x:Math.round(e.offsetX/n.x),y:Math.round(e.offsetY/n.y)}},n={"(root)":{"(root)":{"change-model":a}},"(self)":{"(self)":{added:r,removed:s},"(all)":{change:o}}},c={type:"content-view-layer",name:"content-view-layer",containable:!0,container_type:"layer",description:"Content View Layer Specification",defaults:{},model_event_map:n,view_event_map:c,model_initialize_fn:i,view_factory_fn:l,toolbox_image:"images/toolbox_content_view_layer.png"}})}.call(this),function(){e("build/spec/SpecPresenter",["KineticJS","./SpecInfographic","./SpecContentViewLayer","./SpecGroup","./SpecRect","./SpecRing","./SpecRuler"],function(t,e,n,i,r,o,a){"use strict";var s;return s=function(e){return new t.Stage(e)},{type:"presenter-app",name:"presenter-app",containable:!0,container_type:"application",description:"Presenter Application Specification",defaults:{},view_factory_fn:s,dependencies:{infographic:e,"content-view-layer":n,group:i,rect:r,ring:o,ruler:a},layers:[{type:"content-view-layer",attrs:{}}],toolbox_image:"images/toolbox_presenter_app.png"}})}.call(this),function(){e("build/ApplicationContext",["dou","KineticJS","./MVCMixin","./Component","./Container","./EventEngine","./EventTracker","./ComponentFactory","./Command","./CommandManager","./command/CommandPropertyChange","./ComponentRegistry","./ComponentSelector","./SelectionManager","./Clipboard","./ComponentSpec","./spec/SpecPainter","./spec/SpecPresenter","./spec/SpecInfographic","./command/CommandMove"],function(t,e,n,i,r,o,a,s,c,l,u,h,p,d){"use strict";var f;return f=function(){function t(t){var e,n,i,r,c,u,f,g;if(this.application_spec=t.application_spec,i=t.container,"string"!=typeof i)throw new Error("container is a mandatory string type option.");if(!this.application_spec)throw new Error("application_spec is a mandatory option");if(this.commandManager=new l,this.selectionManager=new d({onselectionchange:this.onselectionchange,context:this,selectable_fn:function(t){return t.getAttr("id")}}),this.compEventTracker=new a,this.viewEventTracker=new a,this.eventEngine=new o,this.componentRegistry=new h,this.componentRegistry.setRegisterCallback(function(){},this),this.componentRegistry.setUnregisterCallback(function(){},this),this.componentFactory=new s(this.componentRegistry,this.eventEngine,this.viewEventTracker),this.componentRegistry.register(this.application_spec),e={id:"application",container:t.container,width:t.width,height:t.height},this.application=this.componentFactory.createComponent({type:this.application_spec.type,attrs:e},this),this.view=this.componentFactory.createView(this.application,this),this.eventEngine.setRoot(this.application),c=this.view,r=this.application,this.compEventTracker.setSelector({select:function(t,e){return CompoentSelector.select(t,r,e)}}),this.viewEventTracker.setSelector({select:function(t,e){var n,i,o,a,s,l,u,h,d;if("(self)"===t)return e;if("(root)"===t)return c;for(i=p.select(t,r),a=[],s=0,u=i.length;u>s;s++)for(n=i[s],d=n.getViews(),l=0,h=d.length;h>l;l++)o=d[l],a.push(o);return a}}),this.application.on("add",this.onadd,this),this.application.on("remove",this.onremove,this),this.application_spec.layers)for(g=this.application_spec.layers,u=0,f=g.length;f>u;u++)n=g[u],this.application.add(this.componentFactory.createComponent(n,this))}return t.prototype.dispose=function(){return this.application.dispose(),this.compEventTracker.dispose(),this.componentFactory.dispose()},t.prototype.getEventTracker=function(){return this.compEventTracker},t.prototype.getView=function(){return this.view},t.prototype.getModel=function(){return this.model},t.prototype.setModel=function(t){var e;if(t!==this.model)return this.commandManager.reset(),this.selectionManager.reset(),e=this.model,this.model=t,this.application.trigger("change-model",this.model,e)},t.prototype.getApplication=function(){return this.application},t.prototype.findComponent=function(t){return p.select(t,this.application)},t.prototype.findView=function(t){return this.view.find(t)},t.prototype.findViewByComponent=function(t){return this.view.find("#"+t.get("id"))},t.prototype.createView=function(t){return this.componentFactory.createView(t,this)},t.prototype.createComponent=function(t){return this.componentFactory.createComponent(t,this)},t.prototype.drawView=function(){return this.view.batchDraw()},t.prototype.execute=function(t){return this.commandManager.execute(t)},t.prototype.setSize=function(t,e){var n;return n=this.view.getSize(),this.view.setSize({width:t,height:e}),this.view.fire("resize",{before:n,after:{width:t,height:e}})},t.prototype.onadd=function(t,e){var n,i;return i=t===this.application?this.view:this.findViewByComponent(t),n=this.createView(e),i.add(n),this.drawView()},t.prototype.onremove=function(t,e){var n;return n=this.findViewByComponent(e),n.destroy(),this.drawView()},t.prototype.onselectionchange=function(t){return this.application.trigger("change-selections",t.after,t.before,t.added,t.removed)},t.prototype.redo=function(){return this.commandManager.redo()},t.prototype.undo=function(){return this.commandManager.undo()},t.prototype.setScale=function(t){return this.getView().scale({x:t,y:t}),this.drawView()},t.prototype.scaleEnlarge=function(){var t;return t=this.getView().scaleX(),this.setScale(t+1>8?8:t+1)},t.prototype.scaleReduce=function(){var t;return t=this.getView().scaleX(),this.setScale(1>t-1?1:t-1)},t}(),t.mixin(f,n.controller),f})}.call(this),function(){var t=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};e("build/Module",[],function(){var e,n;return n=["extended","included"],e=function(){function e(){}return e.extend=function(e){var i,r,o;for(i in e)r=e[i],t.call(n,i)<0&&(this[i]=r);return null!=(o=e.extended)&&o.apply(this),this},e.include=function(e){var i,r,o;for(i in e)r=e[i],t.call(n,i)<0&&(this.prototype[i]=r);return null!=(o=e.included)&&o.apply(this),this},e}()})}.call(this),function(){e("build/infopik",["./ApplicationContext","./Command","./CommandManager","./command/CommandPropertyChange","./Component","./ComponentFactory","./ComponentRegistry","./ComponentSelector","./ComponentSpec","./Container","./EventEngine","./EventPump","./EventTracker","./Module","./MVCMixin","./SelectionManager","./handle/HandleChecker","./spec/SpecBarcode","./spec/SpecContentEditLayer","./spec/SpecContentViewLayer","./spec/SpecGroup","./spec/SpecGuideLayer","./spec/SpecHandleLayer","./spec/SpecImage","./spec/SpecInfographic","./spec/SpecPainter","./spec/SpecPresenter","./spec/SpecRect","./spec/SpecCircle","./spec/SpecRing","./spec/SpecRuler","./spec/SpecRulerLayer","./spec/SpecStar","./spec/SpecText"],function(t,e,n,i,r,o,a,s,c,l,u,h,p,d,f,g,_,y,m,v,w,x,b,S,k,C,A,M,T,R,O,P,E){"use strict";return{app:function(e){return new t(e)},spec:{painter:C,presenter:A,rect:M,circle:T,ring:R,ruler:O,star:E,infographic:k,barcode:y,image:S,group:w}}})}.call(this),t.infopik=n("build/infopik")}(this);